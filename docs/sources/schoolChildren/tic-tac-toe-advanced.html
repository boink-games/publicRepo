<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Ticâ€‘Tacâ€‘Toe Advanced</title>
<style>
:root{
  --bg1:#0a1224;
  --bg2:#0f1631;
  --panel:#0f172a;
  --panel-2:#101a36;
  --accent:#6ee7ff;
  --accent-2:#a78bfa;
  --x:#67e8f9;
  --o:#fda4af;
  --win:#22c55e;
  --cell:clamp(72px, 22vw, 120px);
  --gap:clamp(8px, 2.2vw, 14px);
  --radius:16px;
  --shadow:0 16px 40px rgba(0,0,0,.45);
  --glow:0 0 0 transparent;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;
  color:#eaf2ff;
  background:
    radial-gradient(1200px 800px at 20% -10%, rgba(167,139,250,.18), transparent 60%),
    radial-gradient(900px 900px at 120% 10%, rgba(110,231,255,.12), transparent 50%),
    linear-gradient(135deg, var(--bg1), var(--bg2));
  min-height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  -webkit-tap-highlight-color: transparent;
}

.container{
  width: min(100vw, 520px);
  padding: clamp(10px, 3vw, 20px);
}

.card{
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)) padding-box,
              linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,0)) border-box;
  border:1px solid rgba(255,255,255,.12);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(6px);
  padding: clamp(12px, 2.5vw, 18px);
}

.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom: clamp(8px, 1.8vw, 14px);
}

.title{
  font-weight:800;
  letter-spacing:.5px;
  font-size: clamp(18px, 5vw, 22px);
  display:flex;
  align-items:center;
  gap:.6ch;
}
.title .badge{
  font-size:.85em;
  font-weight:700;
  color:#0b1226;
  background: linear-gradient(145deg, #67e8f9, #a78bfa);
  padding:.15rem .5rem;
  border-radius:999px;
}

.controls{
  display:flex;
  gap:8px;
}

.icon-btn{
  appearance:none;
  border:1px solid rgba(255,255,255,.14);
  background: radial-gradient(180% 180% at 20% 0%, rgba(255,255,255,.15), rgba(255,255,255,.06) 50%, rgba(255,255,255,.02) 100%);
  color:#eaf2ff;
  border-radius:10px;
  padding:.55rem .7rem;
  font-weight:700;
  cursor:pointer;
  transition: transform .12s ease, box-shadow .12s ease, background .2s ease, border-color .2s ease;
  box-shadow: 0 4px 14px rgba(0,0,0,.25);
}
.icon-btn:hover{ transform: translateY(-1px); }
.icon-btn:active{ transform: translateY(0); }
.icon-btn[aria-pressed="true"]{
  border-color: rgba(103,232,249,.6);
  box-shadow: 0 0 0 6px rgba(103,232,249,.12);
}

.board{
  display:grid;
  grid-template-columns: repeat(3, var(--cell));
  gap: var(--gap);
  background: linear-gradient(180deg, rgba(16,26,54,.9), rgba(12,18,38,.9));
  border:1px solid rgba(255,255,255,.12);
  border-radius: clamp(12px, 3vw, 18px);
  padding: var(--gap);
  justify-content:center;
  align-content:center;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), var(--shadow);
  position:relative;
}

.cell{
  width: var(--cell);
  aspect-ratio: 1/1;
  border-radius: clamp(10px, 2.2vw, 14px);
  border: 1px solid rgba(255,255,255,.12);
  background:
    radial-gradient(140% 120% at 25% 0%, rgba(255,255,255,.08), rgba(255,255,255,.02) 60%),
    linear-gradient(180deg, rgba(12,18,40,.8), rgba(12,18,36,.7));
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size: clamp(42px, 12vw, 56px);
  font-weight: 900;
  letter-spacing:.04em;
  cursor:pointer;
  user-select:none;
  position:relative;
  box-shadow: inset 0 6px 14px rgba(0,0,0,.35), 0 6px 18px rgba(0,0,0,.25);
  transition: transform .12s ease, box-shadow .12s ease, border-color .2s ease, background .25s ease;
  outline: none;
}
.cell:hover{ transform: translateY(-1px); }
.cell:active{ transform: translateY(0); }
.cell:focus-visible{
  box-shadow: 0 0 0 6px rgba(103,232,249,.18), inset 0 6px 14px rgba(0,0,0,.35);
}

.cell.filled{
  cursor: default;
  transform: none;
}

.cell.mark-x{ color: var(--x); text-shadow: 0 4px 24px rgba(103,232,249,.35); }
.cell.mark-o{ color: var(--o); text-shadow: 0 4px 24px rgba(253,164,175,.35); }

.cell.pop{
  animation: pop .22s ease-out both;
}

.cell.shake{
  animation: shake .28s ease-in-out;
}

.cell.winning{
  border-color: rgba(34,197,94,.9);
  box-shadow: 0 0 0 8px rgba(34,197,94,.12), inset 0 0 24px rgba(34,197,94,.25);
  background:
    radial-gradient(120% 120% at 10% 10%, rgba(34,197,94,.22), rgba(34,197,94,.05) 60%),
    linear-gradient(180deg, rgba(16,26,54,.95), rgba(14,22,44,.9));
}

.status{
  margin-top: clamp(10px, 2.2vw, 14px);
  text-align:center;
  font-weight:800;
  letter-spacing:.4px;
  font-size: clamp(16px, 4.4vw, 18px);
  min-height: 1.6em;
}

footer{
  margin-top: 8px;
  text-align:center;
  font-size: 12px;
  opacity:.6;
}

/* Animations */
@keyframes pop{
  0%{ transform: scale(.6); opacity:.4; filter: blur(1px); }
  100%{ transform: scale(1); opacity:1; filter: none; }
}
@keyframes shake{
  0%,100%{ transform: translateX(0) }
  20%{ transform: translateX(-4px) }
  40%{ transform: translateX(4px) }
  60%{ transform: translateX(-3px) }
  80%{ transform: translateX(3px) }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  *{animation: none !important; transition: none !important}
}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div class="header">
      <div class="title">Ticâ€‘Tacâ€‘Toe <span class="badge">VS AI</span></div>
      <div class="controls">
        <button id="muteBtn" class="icon-btn" type="button" aria-pressed="false" title="Toggle sound">ðŸ”Š</button>
        <button id="resetBtn" class="icon-btn" type="button" title="Reset game">â†» Reset</button>
      </div>
    </div>

    <div id="board" class="board" role="grid" aria-label="Tic Tac Toe board"></div>
    <div id="status" class="status" role="status" aria-live="polite">Your turn</div>
  </div>
  <footer>Tip: Tap a square. Green glow highlights the winning line.</footer>
</div>

<script>
(() => {
  const boardEl = document.getElementById('board');
  const statusEl = document.getElementById('status');
  const resetBtn = document.getElementById('resetBtn');
  const muteBtn = document.getElementById('muteBtn');

  // Game state
  let board = Array(9).fill('');
  const HUMAN = 'X';
  const AI = 'O';
  let gameOver = false;
  let lastMoveIndex = -1;
  let winningLine = null;

  // Precompute winning lines
  const LINES = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  // Audio (WebAudio)
  let audioCtx = null;
  let muted = false;

  function ensureAudio() {
    if (!audioCtx) {
      const Ctx = window.AudioContext || window.webkitAudioContext;
      if (Ctx) audioCtx = new Ctx();
    }
  }

  function resumeAudioIfSuspended() {
    if (audioCtx && audioCtx.state === 'suspended') {
      audioCtx.resume();
    }
  }

  function playTone({freq=440, type='sine', duration=0.08, gain=0.08, when=0}) {
    if (muted || !audioCtx) return;
    const now = audioCtx.currentTime + when;
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, now);
    g.gain.setValueAtTime(0, now);
    g.gain.linearRampToValueAtTime(gain, now + 0.005);
    g.gain.exponentialRampToValueAtTime(0.0001, now + duration);
    osc.connect(g).connect(audioCtx.destination);
    osc.start(now);
    osc.stop(now + duration + 0.02);
  }

  function sfxPlace(isHuman) {
    if (!audioCtx) return;
    if (isHuman) {
      playTone({freq: 680, type:'triangle', duration: 0.07, gain: 0.08});
      playTone({freq: 980, type:'triangle', duration: 0.06, gain: 0.06, when: 0.02});
    } else {
      playTone({freq: 420, type:'sine', duration: 0.07, gain: 0.08});
      playTone({freq: 380, type:'sine', duration: 0.06, gain: 0.06, when: 0.02});
    }
  }

  function sfxWin() {
    if (!audioCtx) return;
    playTone({freq: 523.25, type:'square', duration: 0.09, gain: 0.09});
    playTone({freq: 659.25, type:'square', duration: 0.11, gain: 0.09, when: 0.06});
    playTone({freq: 783.99, type:'square', duration: 0.13, gain: 0.09, when: 0.14});
  }

  function sfxDraw() {
    if (!audioCtx) return;
    playTone({freq: 660, type:'sine', duration: 0.05, gain: 0.06});
    playTone({freq: 600, type:'sine', duration: 0.05, gain: 0.06, when: 0.05});
    playTone({freq: 540, type:'sine', duration: 0.05, gain: 0.06, when: 0.1});
  }

  function sfxError() {
    if (!audioCtx) return;
    playTone({freq: 180, type:'sawtooth', duration: 0.08, gain: 0.08});
    playTone({freq: 140, type:'sawtooth', duration: 0.08, gain: 0.08, when: 0.05});
  }

  function vibrate(pattern) {
    if (navigator.vibrate) {
      try { navigator.vibrate(pattern); } catch {}
    }
  }

  // Create cells once (for performance and better focus/ARIA)
  const cells = [];
  function initBoard() {
    boardEl.innerHTML = '';
    for (let i = 0; i < 9; i++) {
      const btn = document.createElement('button');
      btn.className = 'cell';
      btn.type = 'button';
      btn.setAttribute('role', 'gridcell');
      btn.setAttribute('aria-label', 'Empty');
      btn.dataset.index = i;
      btn.textContent = '';
      cells.push(btn);
      boardEl.appendChild(btn);
    }
  }

  function getWinner(b) {
    for (const [a, c, d] of LINES) {
      if (b[a] && b[a] === b[c] && b[c] === b[d]) {
        return { winner: b[a], line: [a,c,d] };
      }
    }
    if (b.every(Boolean)) return { winner: 'D', line: null };
    return { winner: null, line: null };
  }

  function renderCell(i, animate=false) {
    const c = cells[i];
    const v = board[i];
    c.classList.remove('mark-x','mark-o','filled','pop','winning');
    c.textContent = v || '';
    if (v) {
      c.classList.add('filled', v === 'X' ? 'mark-x' : 'mark-o');
      c.setAttribute('aria-label', v === 'X' ? 'X' : 'O');
      if (animate) {
        c.classList.add('pop');
      }
    } else {
      c.setAttribute('aria-label', 'Empty');
    }
  }

  function renderBoard(animateIndex=-1) {
    for (let i = 0; i < 9; i++) {
      renderCell(i, i === animateIndex);
    }
    // Highlight winning line if exists
    if (winningLine) {
      winningLine.forEach(idx => cells[idx].classList.add('winning'));
    }
  }

  function setStatus(text) {
    statusEl.textContent = text;
  }

  function isMoveAllowed(i) {
    return !gameOver && !board[i];
  }

  function handleHumanMove(i, targetEl) {
    if (!isMoveAllowed(i)) {
      if (targetEl) {
        targetEl.classList.remove('shake');
        // reflow trick to restart animation
        void targetEl.offsetWidth;
        targetEl.classList.add('shake');
      }
      sfxError();
      return;
    }
    board[i] = HUMAN;
    lastMoveIndex = i;
    sfxPlace(true);
    vibrate(10);

    const { winner, line } = getWinner(board);
    winningLine = line;
    renderBoard(i);

    if (winner) {
      finish(winner);
      return;
    }

    setStatus("AI is thinking...");
    // Slight delay for natural feel
    setTimeout(aiMove, 280);
  }

  function aiMove() {
    if (gameOver) return;
    const moveIndex = findBestMove(board);
    if (moveIndex != null) {
      board[moveIndex] = AI;
      lastMoveIndex = moveIndex;
      sfxPlace(false);
      const result = getWinner(board);
      winningLine = result.line;
      renderBoard(moveIndex);

      if (result.winner) {
        finish(result.winner);
      } else {
        setStatus("Your turn");
      }
    }
  }

  function finish(result) {
    gameOver = true;
    if (result === 'D') {
      setStatus("It's a draw");
      sfxDraw();
      vibrate([20,40,20]);
    } else {
      setStatus(result + " wins!");
      sfxWin();
      vibrate([30, 60, 30]);
    }
    // Keep the board for a moment, then reset automatically
    setTimeout(reset, 1400);
  }

  function reset() {
    board = Array(9).fill('');
    gameOver = false;
    lastMoveIndex = -1;
    winningLine = null;
    setStatus("Your turn");
    renderBoard();
  }

  // Minimax with alpha-beta pruning
  function findBestMove(b) {
    let bestScore = -Infinity;
    let bestIndex = null;
    for (let i = 0; i < 9; i++) {
      if (!b[i]) {
        b[i] = AI;
        const score = minimax(b, false, -Infinity, Infinity);
        b[i] = '';
        if (score > bestScore) {
          bestScore = score;
          bestIndex = i;
        }
      }
    }
    return bestIndex;
  }

  function minimax(boardState, isMaximizing, alpha, beta) {
    const { winner } = getWinner(boardState);
    if (winner) {
      if (winner === AI) return 1;
      if (winner === HUMAN) return -1;
      return 0;
    }

    if (isMaximizing) {
      let best = -Infinity;
      for (let i = 0; i < 9; i++) {
        if (!boardState[i]) {
          boardState[i] = AI;
          best = Math.max(best, minimax(boardState, false, alpha, beta));
          boardState[i] = '';
          alpha = Math.max(alpha, best);
          if (beta <= alpha) break;
        }
      }
      return best;
    } else {
      let best = Infinity;
      for (let i = 0; i < 9; i++) {
        if (!boardState[i]) {
          boardState[i] = HUMAN;
          best = Math.min(best, minimax(boardState, true, alpha, beta));
          boardState[i] = '';
          beta = Math.min(beta, best);
          if (beta <= alpha) break;
        }
      }
      return best;
    }
  }

  // Event listeners (pointer for touch + mouse)
  boardEl.addEventListener('pointerdown', (e) => {
    ensureAudio();
    resumeAudioIfSuspended();
    const target = e.target.closest('.cell');
    if (!target) return;
    const idx = Number(target.dataset.index);
    handleHumanMove(idx, target);
  }, { passive: true });

  // Keyboard support (optional)
  boardEl.addEventListener('keydown', (e) => {
    const target = e.target.closest('.cell');
    if (!target) return;
    const idx = Number(target.dataset.index);
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      ensureAudio();
      resumeAudioIfSuspended();
      handleHumanMove(idx, target);
    }
  });

  // Controls
  resetBtn.addEventListener('click', () => {
    ensureAudio();
    resumeAudioIfSuspended();
    reset();
  });

  muteBtn.addEventListener('click', () => {
    ensureAudio();
    resumeAudioIfSuspended();
    muted = !muted;
    muteBtn.setAttribute('aria-pressed', String(!muted ? false : true));
    muteBtn.textContent = muted ? 'ðŸ”‡' : 'ðŸ”Š';
  });

  // Kickoff
  initBoard();
  renderBoard();
})();
</script>
</body>
</html>