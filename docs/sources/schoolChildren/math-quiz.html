<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#b5fffc" />
  <title>Math Sprint 🌈</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#FFDEE9; --bg2:#B5FFFC; --bg3:#FEC4FF; --bg4:#B2F7EF;
      --card:#ffffffcc; --card-strong:#ffffff;
      --text:#1f2937; --muted:#475569;
      --good:#22c55e; --bad:#ef4444; --accent:#fb923c; --accent2:#60a5fa;
      --shadow:0 14px 30px rgba(0,0,0,.15);
      --radius:22px;
      --tap:20px;
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; margin:0; }
    body{
      font-family: "Baloo 2", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color:var(--text);
      background: linear-gradient(120deg, var(--bg1), var(--bg2), var(--bg3), var(--bg4));
      background-size: 400% 400%;
      animation: bgShift 18s ease infinite;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: max(10px, env(safe-area-inset-top)) max(10px, env(safe-area-inset-right)) max(10px, env(safe-area-inset-bottom)) max(10px, env(safe-area-inset-left));
      touch-action: manipulation;
      user-select: none;
    }
    @keyframes bgShift{
      0%{ background-position: 0% 50%; }
      50%{ background-position: 100% 50%; }
      100%{ background-position: 0% 50%; }
    }
    @media (prefers-reduced-motion: reduce){
      body{ animation: none; }
    }
    .wrap{ width:min(760px, 96vw); display:flex; flex-direction:column; align-items:center; gap: clamp(12px, 2.5vw, 24px); }
    .title{
      margin:0;
      font-size: clamp(26px, 7vw, 48px);
      text-align:center;
      color:#0b1324;
      text-shadow: 0 2px 0 rgba(255,255,255,.6);
      display:flex; align-items:center; justify-content:center; gap:.4em;
    }
    .title .sparkle{ display:inline-block; animation: pop 1.6s ease-in-out infinite; }
    @keyframes pop{ 0%,100%{ transform: translateY(0) scale(1);} 50%{ transform: translateY(-4px) scale(1.08);} }
    @media (prefers-reduced-motion: reduce){
      .title .sparkle{ animation:none; }
    }

    .toolbar{
      width:100%;
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
    }
    .ghost-btn{
      border:none; background: rgba(255,255,255,.8);
      padding: 10px 14px; border-radius: 999px;
      font-weight: 800; color:#0b1324;
      display:inline-flex; align-items:center; gap:.5em;
      box-shadow: 0 6px 18px rgba(0,0,0,.08);
      cursor: pointer;
    }
    .ghost-btn:active{ transform: translateY(1px); }
    .ghost-btn[aria-pressed="false"] .off{ display:none; }
    .ghost-btn[aria-pressed="true"] .on{ display:none; }

    .card{
      width:100%;
      background: var(--card);
      backdrop-filter: blur(8px) saturate(120%);
      border: 3px solid rgba(255,255,255,.7);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(14px, 3.5vw, 28px);
      display:flex;
      flex-direction:column;
      gap: clamp(14px, 2.5vw, 24px);
      position:relative;
      overflow:hidden;
      isolation:isolate;
    }

    /* Decorative floating orbs inside the card for subtle motion */
    .card::before, .card::after{
      content:"";
      position:absolute;
      width: 180px; height: 180px;
      border-radius: 50%;
      filter: blur(30px);
      opacity:.35;
      z-index:-1;
      animation: floaty 16s ease-in-out infinite;
      pointer-events:none;
    }
    .card::before{
      top:-40px; left:-40px;
      background: radial-gradient(circle at 30% 30%, #a5b4fc, transparent 60%);
      animation-delay: 0s;
    }
    .card::after{
      bottom:-60px; right:-40px;
      background: radial-gradient(circle at 70% 70%, #f0abfc, transparent 60%);
      animation-delay: 3s;
    }
    @keyframes floaty{
      0%, 100%{ transform: translateY(0) translateX(0) scale(1); }
      50%{ transform: translateY(12px) translateX(8px) scale(1.05); }
    }
    @media (prefers-reduced-motion: reduce){
      .card::before, .card::after{ animation:none; }
    }

    .expr{
      font-weight:800;
      font-size: clamp(36px, 12vw, 76px);
      letter-spacing: 1.5px;
      text-align:center;
      color:#111827;
      line-height:1.05;
      display:flex; align-items:center; justify-content:center; gap:.35em; flex-wrap:wrap;
      text-shadow: 0 2px 0 rgba(255,255,255,.7);
    }
    .expr .qmark{ color:var(--accent); filter: drop-shadow(0 2px 0 rgba(255,255,255,.7)); }
    .expr.correct{ animation: bounce 600ms ease; color: #065f46; }
    .expr.wrong{ animation: shake 420ms ease; color:#7f1d1d; }
    @keyframes bounce{
      0%{ transform: scale(1); }
      30%{ transform: scale(1.08); }
      60%{ transform: scale(0.97); }
      100%{ transform: scale(1); }
    }
    @keyframes shake{
      0%{ transform: translateX(0); }
      20%{ transform: translateX(-12px); }
      40%{ transform: translateX(10px); }
      60%{ transform: translateX(-8px); }
      80%{ transform: translateX(6px); }
      100%{ transform: translateX(0); }
    }

    .opts{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: clamp(10px, 2.5vw, 16px);
      width:100%;
    }
    @media (min-width: 520px){
      .opts{ grid-template-columns: repeat(4, 1fr); }
    }

    .btn{
      position:relative;
      display:flex; align-items:center; justify-content:center; gap:.5em;
      width:100%;
      border:none;
      border-radius: 18px;
      padding: clamp(14px, 3.6vw, 22px) clamp(12px, 2.8vw, 18px);
      font-weight:800;
      font-size: clamp(22px, 6vw, 32px);
      color:#0b1324;
      cursor:pointer;
      background: linear-gradient(135deg, #fff7, #fff0);
      box-shadow: 0 8px 0 rgba(0,0,0,.08), 0 12px 22px rgba(0,0,0,.12);
      outline:none;
      transition: transform .06s ease, box-shadow .2s ease, filter .15s ease;
      min-height: 64px;
      touch-action: manipulation;
      overflow: hidden;
    }
    .btn:active{ transform: translateY(2px) scale(.98); box-shadow: 0 5px 0 rgba(0,0,0,.06), 0 8px 18px rgba(0,0,0,.10); }
    .btn .emoji{ font-size: 1.1em; }
    .btn[disabled]{ opacity:.6; filter: grayscale(.2); cursor:not-allowed; }

    /* Ripple effect */
    .ripple {
      position:absolute; border-radius:50%;
      transform: scale(0); pointer-events:none; opacity:.45;
      background: currentColor;
      mix-blend-mode: multiply;
      animation: ripple .5s ease-out forwards;
    }
    @keyframes ripple {
      to { transform: scale(4); opacity: 0; }
    }
    @media (prefers-reduced-motion: reduce){
      .ripple{ display:none; }
    }

    .choice{
      background: var(--grad, linear-gradient(135deg, #fde68a, #fca5a5));
      color:#0b1324;
      border: 3px solid rgba(255,255,255,.9);
      box-shadow: inset 0 -4px 12px rgba(255,255,255,.35);
    }
    .choice.correct{
      background: linear-gradient(135deg, #bbf7d0, #86efac);
      border-color: #16a34a;
      animation: pulse 600ms ease;
      box-shadow: 0 0 0 4px rgba(34,197,94,.2), inset 0 -4px 12px rgba(255,255,255,.45);
    }
    .choice.wrong{
      background: linear-gradient(135deg, #fecaca, #fca5a5);
      border-color: #ef4444;
      animation: wobble 420ms ease;
      box-shadow: 0 0 0 4px rgba(239,68,68,.2), inset 0 -4px 12px rgba(255,255,255,.45);
    }

    @keyframes pulse{
      0%{ transform: scale(1); }
      50%{ transform: scale(1.05); }
      100%{ transform: scale(1); }
    }
    @keyframes wobble{
      0%{ transform: rotate(0deg); }
      25%{ transform: rotate(-5deg); }
      50%{ transform: rotate(4deg); }
      75%{ transform: rotate(-3deg); }
      100%{ transform: rotate(0deg); }
    }

    .meta{
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
      color:#0b1324;
      font-size: clamp(16px, 4.3vw, 20px);
      padding: 8px 10px;
      background: linear-gradient(90deg, rgba(255,255,255,.9), rgba(255,255,255,.75));
      border-radius: 14px;
      border: 2px solid rgba(255,255,255,.9);
    }
    .stat{ display:flex; align-items:center; gap:.35em; font-weight:800; }
    .stat.good{ color:#065f46; }
    .stat.bad{ color:#7f1d1d; }
    .stat.time{ color:#1e3a8a; }

    .bar{
      flex:1 1 100%;
      width:100%;
      height: 18px;
      border-radius: 999px;
      background: #e2e8f0;
      overflow:hidden;
      border: 2px solid #fff;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.04);
    }
    .bar > .fill{
      height:100%;
      width:100%;
      background: linear-gradient(90deg, #4ade80, #facc15, #fb7185);
      transition: width .35s ease;
    }

    .row-center{ display:flex; justify-content:center; }
    .restart{
      font-size: clamp(18px, 5.5vw, 24px);
      padding: 14px 18px;
      border-radius: 999px;
      border:none;
      background: linear-gradient(135deg, #a5b4fc, #f0abfc);
      color:#0b1324;
      font-weight:800;
      box-shadow: 0 8px 0 rgba(0,0,0,.08), 0 12px 22px rgba(0,0,0,.12);
      cursor:pointer;
      display:inline-flex; align-items:center; gap:.6em;
    }
    .restart:active{ transform: translateY(2px); }

    .end{
      position:absolute; inset:0;
      background: radial-gradient(1200px 400px at 50% 0%, rgba(255,255,255,.96), rgba(255,255,255,.75));
      display:none;
      align-items:center; justify-content:center;
      text-align:center;
      padding: 24px;
      flex-direction:column; gap:18px;
      backdrop-filter: blur(2px);
    }
    .end.show{ display:flex; }
    .end h2{ margin:0; font-size: clamp(26px, 8vw, 42px); color:#065f46; }
    .end p{ margin:0; font-size: clamp(18px, 5vw, 22px); color:#0b1324; }
    .end .big-score{ font-size: clamp(22px, 7vw, 34px); font-weight:800; }

    #confetti{
      pointer-events:none;
      position: fixed; inset: 0;
      overflow: hidden;
      z-index: 9;
    }
    .confetti{
      position:absolute;
      width: 10px; height: 14px;
      opacity: .9;
      border-radius: 2px;
      transform: translate3d(0,0,0);
      animation: confettiPop var(--dur,900ms) ease-out forwards;
    }
    @keyframes confettiPop{
      0%{ transform: translate(0,0) rotate(0deg); opacity: 1; }
      100%{ transform: translate(var(--tx, 80px), var(--ty, -120px)) rotate(var(--rot, 180deg)); opacity: 0; }
    }

    .btn:focus-visible, .restart:focus-visible, .ghost-btn:focus-visible{
      outline: 4px solid #fbbf24;
      outline-offset: 2px;
    }
    .sr-only{
      position:absolute;
      width:1px; height:1px;
      padding:0; margin:-1px;
      overflow:hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap; border:0;
    }
  </style>
</head>
<body>
  <div id="confetti" aria-hidden="true"></div>

  <div class="wrap">
    <h1 class="title"><span class="sparkle">✨</span> Math Sprint <span class="sparkle">🚀</span></h1>

    <div class="toolbar" role="toolbar" aria-label="Game controls">
      <div style="flex:1"></div>
      <button class="ghost-btn" id="soundToggle" type="button" aria-pressed="true" aria-label="Toggle sound">
        <span class="on">🔊</span><span class="off">🔈</span> Sound
      </button>
    </div>

    <div class="card" id="card">
      <div class="expr" id="expr" aria-live="polite" aria-atomic="true">3 + 2 = <span class="qmark">❓</span></div>

      <div class="opts" id="opts" role="group" aria-label="Answer choices"></div>

      <div class="meta">
        <div class="stat good" aria-live="polite" aria-atomic="true">✅ <span id="ok">0</span></div>
        <div class="stat bad" aria-live="polite" aria-atomic="true">❌ <span id="bad">0</span></div>
        <div class="stat time">⏱️ <span id="time">30</span>s</div>
        <div class="bar" aria-hidden="true"><div class="fill" id="fill"></div></div>
      </div>

      <div class="row-center">
        <button class="restart" id="restart" type="button">🔄 Play Again</button>
      </div>

      <div class="end" id="end" aria-modal="true" role="dialog" aria-labelledby="endTitle" aria-describedby="summary">
        <h2 id="endTitle">Time’s up! ⏰</h2>
        <p class="big-score" id="summary">Score: 0 ✅ | 0 ❌</p>
        <button class="restart" id="playAgain" type="button">🎉 Play Again</button>
      </div>
    </div>
    <div class="sr-only" aria-live="polite" id="live"></div>
  </div>

  <script>
    (function(){
      "use strict";

      // DOM
      const exprEl = document.getElementById('expr');
      const optsEl = document.getElementById('opts');
      const okEl = document.getElementById('ok');
      const badEl = document.getElementById('bad');
      const timeEl = document.getElementById('time');
      const fillEl = document.getElementById('fill');
      const restartBtn = document.getElementById('restart');
      const endScreen = document.getElementById('end');
      const playAgainBtn = document.getElementById('playAgain');
      const summaryEl = document.getElementById('summary');
      const endTitleEl = document.getElementById('endTitle');
      const cardEl = document.getElementById('card');
      const confettiLayer = document.getElementById('confetti');
      const liveEl = document.getElementById('live');
      const soundToggle = document.getElementById('soundToggle');

      // Sound FX using Web Audio
      class SoundFX {
        constructor(){
          this._ctx = null;
          this.enabled = true;
          this._unlocked = false;
        }
        get ctx(){
          if(!this._ctx){
            this._ctx = new (window.AudioContext || window.webkitAudioContext)();
          }
          return this._ctx;
        }
        unlock(){
          if(this._unlocked) return;
          try{
            const ctx = this.ctx;
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.connect(g); g.connect(ctx.destination);
            g.gain.setValueAtTime(0, ctx.currentTime);
            o.start(); o.stop(ctx.currentTime + 0.01);
            ctx.resume();
            this._unlocked = true;
          }catch{}
        }
        playTone(type, freq, dur, vol=0.08){
          if(!this.enabled) return;
          const ctx = this.ctx;
          const t = ctx.currentTime;
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = type;
          o.frequency.setValueAtTime(freq, t);
          g.gain.setValueAtTime(0, t);
          g.gain.linearRampToValueAtTime(vol, t + 0.01);
          g.gain.exponentialRampToValueAtTime(0.0001, t + Math.max(0.05, dur));
          o.connect(g); g.connect(ctx.destination);
          o.start(t);
          o.stop(t + dur + 0.05);
        }
        correct(){
          this.playTone('sine', 660, 0.12, 0.08);
          setTimeout(()=>this.playTone('sine', 880, 0.12, 0.08), 90);
          setTimeout(()=>this.playTone('sine', 990, 0.14, 0.08), 180);
        }
        wrong(){
          if(!this.enabled) return;
          const ctx = this.ctx; const t = ctx.currentTime;
          const o = ctx.createOscillator(); const g = ctx.createGain();
          o.type='square';
          o.frequency.setValueAtTime(240, t);
          o.frequency.exponentialRampToValueAtTime(110, t+0.28);
          g.gain.setValueAtTime(0, t);
          g.gain.linearRampToValueAtTime(0.08, t+0.01);
          g.gain.exponentialRampToValueAtTime(0.0001, t+0.32);
          o.connect(g); g.connect(ctx.destination);
          o.start(t); o.stop(t+0.35);
        }
        click(){ this.playTone('triangle', 420, 0.06, 0.05); }
        tick(){ this.playTone('square', 900, 0.04, 0.045); }
        end(){
          this.playTone('sine', 523, 0.12, 0.07);
          setTimeout(()=>this.playTone('sine', 659, 0.12, 0.07), 120);
          setTimeout(()=>this.playTone('sine', 784, 0.16, 0.08), 240);
        }
      }
      const sfx = new SoundFX();

      // Game State
      const DURATION = 30;
      const COLORS = ['#f87171','#fb923c','#f59e0b','#84cc16','#34d399','#22d3ee','#60a5fa','#a78bfa','#f472b6','#fb7185'];
      const GRADS = [
        ['#fde68a','#fca5a5'], ['#93c5fd','#c4b5fd'], ['#86efac','#a7f3d0'], ['#fbcfe8','#f5d0fe'],
        ['#fdba74','#fca5a5'], ['#a7f3d0','#67e8f9'], ['#fcd34d','#fda4af'], ['#c7d2fe','#fbcfe8']
      ];
      const Ops = ['+','-','×'];

      const state = {
        ok:0, bad:0, t:DURATION, timer:null,
        a:0, b:0, op:'+', ans:0, active:true
      };

      function randint(a,b){ return (Math.random() * (b - a + 1) + a) | 0; }
      function choice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
      function vibrate(pattern){ if(navigator.vibrate){ try{ navigator.vibrate(pattern); }catch{} } }

      function randomGrad(){
        const [c1,c2] = choice(GRADS);
        return `linear-gradient(135deg, ${c1}, ${c2})`;
      }

      function newQuestion(){
        state.active = true;
        state.op = choice(Ops);
        if(state.op === '+'){ state.a = randint(1, 20); state.b = randint(1, 20); state.ans = state.a + state.b; }
        else if(state.op === '-'){
          state.a = randint(6, 30);
          state.b = randint(1, Math.min(state.a - 1, 20));
          state.ans = state.a - state.b;
        } else { // ×
          state.a = randint(2, 10);
          state.b = randint(2, 10);
          state.ans = state.a * state.b;
        }

        exprEl.classList.remove('correct','wrong');
        exprEl.innerHTML = `${state.a} ${state.op} ${state.b} = <span class="qmark">❓</span>`;
        liveEl.textContent = `New question: ${state.a} ${state.op} ${state.b}`;

        // options
        const correct = state.ans;
        const set = new Set([correct]);
        const options = [correct];

        while(options.length < 4){
          let v;
          if(state.op === '×'){
            v = correct + randint(-10, 10);
          } else {
            v = correct + randint(-7, 7);
          }
          if(v < 0) continue;
          if(!set.has(v)){
            set.add(v);
            options.push(v);
          }
        }
        // shuffle
        for(let i=options.length-1;i>0;i--){
          const j = Math.floor(Math.random()*(i+1));
          [options[i], options[j]] = [options[j], options[i]];
        }

        // render options (no per-button listeners; use delegation)
        optsEl.innerHTML = '';
        options.forEach(v=>{
          const btn = document.createElement('button');
          btn.className = 'btn choice';
          btn.type = 'button';
          btn.setAttribute('aria-label', `Answer ${v}`);
          btn.dataset.value = v;
          btn.style.setProperty('--grad', randomGrad());
          btn.innerHTML = `<span class="emoji">👆</span> <strong>${v}</strong>`;
          optsEl.appendChild(btn);
        });
      }

      function handlePick(target){
        if(!state.active) return;
        const value = Number(target.dataset.value);
        const correct = value === state.ans;
        state.active = false;

        if(correct){
          state.ok++;
          okEl.textContent = state.ok;
          target.classList.add('correct');
          exprEl.classList.add('correct');
          popConfettiFrom(target);
          vibrate(30);
          sfx.correct();
        }else{
          state.bad++;
          badEl.textContent = state.bad;
          target.classList.add('wrong');
          exprEl.classList.add('wrong');
          const buttons = Array.from(optsEl.children);
          const goodBtn = buttons.find(b => Number(b.dataset.value) === state.ans);
          if(goodBtn){ goodBtn.classList.add('correct'); }
          shake(cardEl);
          vibrate([120,50,120]);
          sfx.wrong();
        }
        setTimeout(newQuestion, 650);
      }

      function shake(el){
        el.style.transition = 'transform .05s';
        el.style.transform = 'translateX(0)';
        requestAnimationFrame(()=>{
          el.style.transform = 'translateX(-2px)';
          setTimeout(()=>{ el.style.transform = 'translateX(2px)'; }, 50);
          setTimeout(()=>{ el.style.transform = 'translateX(0)'; }, 100);
        });
      }

      function tick(){
        state.t--;
        if(state.t < 0) state.t = 0;
        timeEl.textContent = state.t;
        const pct = (state.t / DURATION) * 100;
        fillEl.style.width = pct + '%';
        if(state.t > 0 && state.t <= 5){ sfx.tick(); }
        if(state.t <= 0){
          stopTimer();
          endGame();
        }
      }

      function startTimer(){
        stopTimer();
        state.timer = setInterval(tick, 1000);
      }
      function stopTimer(){ if(state.timer){ clearInterval(state.timer); state.timer = null; } }

      function endGame(){
        Array.from(optsEl.children).forEach(b => b.disabled = true);
        const message = state.ok >= state.bad ? 'Amazing job! 🌟' : 'You can do it! 💪';
        endTitleEl.textContent = `Time’s up! ⏰ ${message}`;
        summaryEl.textContent = `Score: ${state.ok} ✅ | ${state.bad} ❌`;
        endScreen.classList.add('show');
        setTimeout(()=>popConfettiCenter(120), 50);
        sfx.end();
      }

      function resetGame(){
        state.ok = 0;
        state.bad = 0;
        state.t = DURATION;
        okEl.textContent = '0';
        badEl.textContent = '0';
        timeEl.textContent = DURATION;
        fillEl.style.width = '100%';
        endScreen.classList.remove('show');
        Array.from(optsEl.children).forEach(b => b.disabled = false);
        newQuestion();
        startTimer();
        sfx.click();
      }

      // Confetti helpers
      function popConfettiFrom(el){
        const rect = el.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;
        popConfetti(x, y, 18 + randint(4,10));
      }
      function popConfettiCenter(count=24){
        const rect = cardEl.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height * 0.25;
        popConfetti(x, y, count);
      }
      function popConfetti(x, y, count){
        for(let i=0;i<count;i++){
          const piece = document.createElement('div');
          piece.className = 'confetti';
          const angle = Math.random() * Math.PI * 2;
          const power = 80 + Math.random()*120;
          const tx = Math.cos(angle) * power;
          const ty = Math.sin(angle) * power - (80 + Math.random()*80);
          const rot = (Math.random() * 540 - 270) + 'deg';
          const dur = 700 + Math.random()*700;
          piece.style.left = (x) + 'px';
          piece.style.top = (y) + 'px';
          piece.style.background = COLORS[i % COLORS.length];
          piece.style.setProperty('--tx', tx + 'px');
          piece.style.setProperty('--ty', ty + 'px');
          piece.style.setProperty('--rot', rot);
          piece.style.setProperty('--dur', dur + 'ms');
          confettiLayer.appendChild(piece);
          piece.addEventListener('animationend', ()=> piece.remove(), { once:true });
        }
      }

      // Event delegation for option clicks + ripple + touch-friendly
      function createRipple(x, y, container){
        const rect = container.getBoundingClientRect();
        const span = document.createElement('span');
        span.className = 'ripple';
        const size = Math.max(rect.width, rect.height) * 0.6;
        span.style.width = span.style.height = size + 'px';
        span.style.left = (x - rect.left - size/2) + 'px';
        span.style.top = (y - rect.top - size/2) + 'px';
        container.appendChild(span);
        span.addEventListener('animationend', ()=> span.remove(), { once:true });
      }

      optsEl.addEventListener('pointerdown', (e)=>{
        const btn = e.target.closest('button.choice');
        if(!btn || btn.disabled) return;
        createRipple(e.clientX, e.clientY, btn);
      }, { passive:true });

      optsEl.addEventListener('click', (e)=>{
        const btn = e.target.closest('button.choice');
        if(!btn || btn.disabled) return;
        handlePick(btn);
      });

      // Controls
      restartBtn.addEventListener('click', resetGame);
      playAgainBtn.addEventListener('click', resetGame);

      // Keyboard support (optional)
      window.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' && endScreen.classList.contains('show')){ resetGame(); }
      });

      // Sound toggle
      soundToggle.addEventListener('click', ()=>{
        sfx.enabled = !sfx.enabled;
        soundToggle.setAttribute('aria-pressed', String(sfx.enabled));
        sfx.click();
      });

      // Unlock audio on first interaction
      function unlockOnFirstInteraction(){
        sfx.unlock();
        document.removeEventListener('pointerdown', unlockOnFirstInteraction);
        document.removeEventListener('keydown', unlockOnFirstInteraction);
      }
      document.addEventListener('pointerdown', unlockOnFirstInteraction, { passive:true });
      document.addEventListener('keydown', unlockOnFirstInteraction);

      // Init
      resetGame();
    })();
  </script>
</body>
</html>