<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sun & Moon Tic‚ÄëTac‚ÄëToe</title>
<style>
  :root{
    --bg:#0a1224;
    --bg2:#0e1a3a;
    --panel:#0f172a;
    --tile:#112049;
    --tile-2:#132a5d;
    --accent:#ffcf33; /* sun */
    --accent2:#7db2ff; /* moon */
    --gap:10px;
    --radius:18px;
    --shadow:0 14px 40px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background: radial-gradient(1200px 600px at 10% 0%, #0c1a38, transparent),
                radial-gradient(800px 600px at 90% 30%, #0c213f, transparent),
                linear-gradient(180deg, var(--bg), var(--bg2));
    color:#f8fafc;
    font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol", sans-serif;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    touch-action:manipulation;
    user-select:none;
    overflow:hidden;
  }
  .ambient{
    position:fixed; inset:0; pointer-events:none; overflow:hidden;
  }
  .bubble{
    position:absolute;
    width:120px; height:120px; border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.12), rgba(255,255,255,0) 60%),
                rgba(255,255,255,.04);
    filter: blur(1px);
    animation: float 18s linear infinite;
  }
  .bubble.b1{ top:10%; left:-60px; animation-duration:22s}
  .bubble.b2{ top:70%; left:10%; width:160px; height:160px; animation-duration:26s}
  .bubble.b3{ top:30%; right:-80px; width:180px; height:180px; animation-duration:20s}
  @keyframes float{
    from{ transform: translateY(20px) translateX(0)}
    50%{ transform: translateY(-10px) translateX(10px)}
    to{ transform: translateY(20px) translateX(0)}
  }

  .wrap{
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:16px;
  }
  .game{
    width:min(92vmin, 520px);
    display:grid;
    grid-template-rows: auto auto 1fr auto;
    gap:12px;
  }
  .header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08);
    border-radius:var(--radius);
    padding:10px 12px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(3px);
  }
  .title{
    display:flex; align-items:center; gap:8px; font-weight:900; letter-spacing:.3px;
    font-size:clamp(16px, 2.6vmin, 18px);
  }
  .title .sun{ filter: drop-shadow(0 2px 2px rgba(255,207,51,.4)); }
  .title .moon{ filter: drop-shadow(0 2px 2px rgba(125,178,255,.35)); }
  .scores{
    display:flex; align-items:center; gap:14px; font-weight:800;
    font-size:clamp(14px, 2.6vmin, 18px);
  }
  .scores .pair{ display:flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);}
  .scores .sunC{ color:#ffd34d}
  .scores .moonC{ color:#a7c9ff}
  .controls{
    display:flex; gap:8px; justify-content:center;
  }
  .btn{
    appearance:none; border:0; cursor:pointer; border-radius:14px;
    background:linear-gradient(180deg, rgba(255,255,255,.1), rgba(255,255,255,.04));
    border:1px solid rgba(255,255,255,.12);
    color:#fff; padding:10px 12px; font-weight:800;
    display:flex; align-items:center; gap:8px;
    box-shadow: var(--shadow);
    transition: transform .08s ease, filter .2s ease;
    font-size:clamp(14px, 2.8vmin, 18px);
  }
  .btn:active{ transform: scale(.97)}
  .btn.secondary{ background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03))}
  .btn .ico{ font-size:1.2em }
  .board{
    width:100%;
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08);
    border-radius:var(--radius);
    padding:clamp(10px, 2.3vmin, 14px);
    box-shadow: var(--shadow);
  }
  .grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:var(--gap);
  }
  .cell{
    display:grid; place-items:center;
    aspect-ratio:1/1;
    border-radius:14px;
    background: radial-gradient(120% 120% at 20% 20%, var(--tile), var(--tile-2));
    border:1px solid rgba(255,255,255,.08);
    font-size:clamp(38px, 9.6vmin, 64px);
    line-height:1;
    cursor:pointer;
    transition: transform .1s ease, box-shadow .2s ease, background .2s ease;
    position:relative; overflow:hidden;
    -webkit-tap-highlight-color: transparent;
  }
  .cell:focus-visible{ outline:3px solid rgba(125,178,255,.6)}
  .cell:active{ transform: scale(.98) }
  .cell.disabled{ cursor:default; filter:saturate(.9) brightness(.95) }
  .cell .mark{
    transform: scale(.9);
    transition: transform .2s ease, opacity .2s ease;
    opacity:.95;
    text-shadow: 0 10px 18px rgba(0,0,0,.35);
  }
  .cell.pop .mark{ animation: pop .22s ease-out both }
  @keyframes pop{
    from{ transform: scale(.5); opacity:0 }
    70%{ transform: scale(1.08); opacity:1 }
    to{ transform: scale(1); }
  }
  .cell.win{
    box-shadow: 0 0 0 3px rgba(255,255,255,.08), 0 0 24px 6px rgba(255,255,255,.12) inset;
    animation: pulse 1s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ filter: brightness(1) }
    50%{ filter: brightness(1.25) }
  }

  .status{
    text-align:center;
    font-weight:900;
    letter-spacing:.3px;
    font-size:clamp(16px, 3vmin, 20px);
    text-shadow:0 8px 18px rgba(0,0,0,.4);
  }
  .status .who{ display:inline-flex; align-items:center; gap:8px; padding:4px 10px; border-radius:999px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08)}
  .status .sunC{ color:#ffd34d}
  .status .moonC{ color:#a7c9ff}

  /* Confetti */
  .confetti{
    position:absolute; inset:0; pointer-events:none; overflow:hidden;
  }
  .confetti i{
    position:absolute; will-change: transform, opacity;
    font-size:clamp(16px, 5vmin, 26px);
    animation: fall 1200ms ease-in forwards;
    filter: drop-shadow(0 6px 8px rgba(0,0,0,.35));
  }
  @keyframes fall{
    0%{ transform: translateY(-20px) rotate(0deg) scale(.8); opacity:0 }
    10%{ opacity:1 }
    100%{ transform: translateY(100vh) rotate(360deg) scale(1); opacity:0 }
  }

  @media (prefers-reduced-motion: reduce){
    .bubble, .cell.pop .mark, .cell.win, .confetti i { animation: none !important }
    .btn, .cell{ transition:none }
  }
</style>
</head>
<body>
<div class="ambient" aria-hidden="true">
  <div class="bubble b1"></div>
  <div class="bubble b2"></div>
  <div class="bubble b3"></div>
</div>
<div class="wrap">
  <div class="game" role="application" aria-label="Sun and Moon Tic Tac Toe">
    <div class="header">
      <div class="title">
        <span class="sun" aria-hidden="true">üåû</span>
        <span>Sun vs Moon</span>
        <span class="moon" aria-hidden="true">üåô</span>
      </div>
      <div class="scores" aria-label="Scoreboard">
        <div class="pair sunC" aria-live="polite"><span aria-hidden="true">üåû</span> <span id="sunScore">0</span></div>
        <div class="pair moonC" aria-live="polite"><span aria-hidden="true">üåô</span> <span id="moonScore">0</span></div>
      </div>
    </div>

    <div class="status" id="status">
      <span class="who"><span class="sunC" aria-hidden="true">üåû</span> Your turn</span>
    </div>

    <div class="board">
      <div class="grid" id="grid" role="grid" aria-label="Tic Tac Toe board"></div>
    </div>

    <div class="controls">
      <button class="btn" id="newGameBtn" type="button" aria-label="New round">
        <span class="ico" aria-hidden="true">üîÅ</span> New Round
      </button>
      <button class="btn secondary" id="resetScoreBtn" type="button" aria-label="Reset scores">
        <span class="ico" aria-hidden="true">üßπ</span> Reset Scores
      </button>
    </div>

    <div class="confetti" id="confetti" aria-hidden="true"></div>
  </div>
</div>

<script>
(function(){
  const PLAYER = 'S'; // Sun
  const AI = 'M';     // Moon
  const ICON = { S:'üåû', M:'üåô' };

  const grid = document.getElementById('grid');
  const statusEl = document.getElementById('status');
  const sunScoreEl = document.getElementById('sunScore');
  const moonScoreEl = document.getElementById('moonScore');
  const newGameBtn = document.getElementById('newGameBtn');
  const resetScoreBtn = document.getElementById('resetScoreBtn');
  const confetti = document.getElementById('confetti');

  let board = Array(9).fill('');
  let turn = PLAYER;
  let over = false;
  let winLine = null;
  let scores = loadScores();

  let thinkingTimer = null;

  function loadScores(){
    try{
      const raw = localStorage.getItem('ttt-sun-moon-score-v1');
      const v = raw ? JSON.parse(raw) : {S:0, M:0};
      return {S:v.S|0, M:v.M|0};
    }catch(e){ return {S:0, M:0}; }
  }
  function saveScores(){
    try{ localStorage.setItem('ttt-sun-moon-score-v1', JSON.stringify(scores)); }catch(e){}
  }
  function updateScores(){
    sunScoreEl.textContent = scores.S;
    moonScoreEl.textContent = scores.M;
  }

  function lines(){
    return [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];
  }
  function winner(){
    for(const [a,b,c] of lines()){
      if(board[a] && board[a] === board[b] && board[b] === board[c]){
        return {who: board[a], line:[a,b,c]};
      }
    }
    return null;
  }

  function render(){
    grid.innerHTML = '';
    grid.setAttribute('aria-busy', 'false');
    board.forEach((v, i) => {
      const btn = document.createElement('button');
      btn.className = 'cell';
      btn.setAttribute('role','gridcell');
      btn.setAttribute('aria-label', `Cell ${i+1}`);
      btn.dataset.index = i;
      if(v){
        const mark = document.createElement('span');
        mark.className = 'mark';
        mark.textContent = ICON[v];
        btn.appendChild(mark);
        btn.classList.add('disabled');
        btn.tabIndex = -1;
      } else {
        btn.tabIndex = 0;
      }
      if(winLine && winLine.includes(i)) btn.classList.add('win');

      btn.addEventListener('click', onCellClick, {passive:true});
      grid.appendChild(btn);
    });
    updateStatus();
  }

  function onCellClick(e){
    const idx = +e.currentTarget.dataset.index;
    movePlayer(idx);
  }

  function movePlayer(i){
    if(over || board[i] || turn !== PLAYER) return;
    place(i, PLAYER, true);
    if(checkEnd()) return;
    grid.setAttribute('aria-busy','true');
    setThinking(true);
    // Slight pause for child-friendly pacing
    clearTimeout(thinkingTimer);
    thinkingTimer = setTimeout(aiMove, 420);
  }

  function aiMove(){
    if(over) return;
    const i = chooseAiMove();
    place(i, AI, true);
    checkEnd();
    setThinking(false);
  }

  function chooseAiMove(){
    const empty = board.map((v,i)=>v?null:i).filter(v=>v!==null);
    // Try to win
    const tryWin = (p)=>{
      for(const i of empty){
        board[i]=p;
        if(winner()){ board[i]=''; return i; }
        board[i]='';
      }
      return null;
    };
    let i = tryWin(AI);
    if(i==null) i = tryWin(PLAYER);
    if(i==null && empty.includes(4)) i = 4;
    if(i==null){
      const corners = [0,2,6,8].filter(c=>empty.includes(c));
      i = (corners.length? corners : empty)[Math.floor(Math.random()*(corners.length? corners.length : empty.length))];
    }
    return i;
  }

  function place(i, who, animate=false){
    board[i] = who;
    const cell = grid.children[i];
    const mark = document.createElement('span');
    mark.className = 'mark';
    mark.textContent = ICON[who];
    cell.innerHTML = '';
    cell.appendChild(mark);
    cell.classList.add('disabled');
    if(animate) cell.classList.add('pop');
    blip(who===PLAYER ? 520 : 340, 0.08);
    turn = (who===PLAYER)? AI: PLAYER;
  }

  function checkEnd(){
    const w = winner();
    if(w){
      over = true;
      winLine = w.line.slice();
      highlightWin();
      scores[w.who] += 1;
      updateScores();
      saveScores();
      celebrate(w.who);
      setTimeout(newRound, 1600);
      return true;
    }
    if(board.every(Boolean)){
      over = true;
      showDraw();
      setTimeout(newRound, 1400);
      return true;
    }
    render(); // refresh status text
    return false;
  }

  function highlightWin(){
    render();
    const msg = wMsg('wins', turn===PLAYER? AI: PLAYER);
    statusEl.innerHTML = msg;
  }

  function wMsg(type, who){
    if(type==='wins'){
      const whoTxt = who===PLAYER? `<span class="sunC" aria-hidden="true">üåû</span> Sun wins!` : `<span class="moonC" aria-hidden="true">üåô</span> Moon wins!`;
      return `<span class="who">${whoTxt}</span>`;
    }
    return '';
  }

  function showDraw(){
    winLine = null;
    statusEl.innerHTML = `<span class="who">ü§ù It's a draw!</span>`;
    blip(240, 0.12);
    render();
  }

  function updateStatus(){
    if(over){
      return;
    }
    if(turn===PLAYER){
      statusEl.innerHTML = `<span class="who"><span class="sunC" aria-hidden="true">üåû</span> Your turn</span>`;
    }else{
      statusEl.innerHTML = `<span class="who"><span class="moonC" aria-hidden="true">üåô</span> Thinking‚Ä¶</span>`;
    }
  }

  function newRound(){
    board = Array(9).fill('');
    over = false;
    winLine = null;
    turn = PLAYER;
    render();
  }

  function setThinking(on){
    if(on){
      statusEl.innerHTML = `<span class="who"><span class="moonC" aria-hidden="true">üåô</span> Thinking‚Ä¶</span>`;
    }else{
      updateStatus();
    }
  }

  function celebrate(who){
    // Winning highlight
    const els = winLine ? winLine.map(i=>grid.children[i]) : [];
    els.forEach(el => el.classList.add('win'));

    // Confetti
    const emojis = who===PLAYER ? ['‚ú®','‚≠ê','üåü','üíõ'] : ['‚ú®','‚≠ê','üíô','üåü'];
    const count = 24;
    for(let k=0;k<count;k++){
      const i = document.createElement('i');
      i.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      i.style.left = Math.random()*100 + 'vw';
      i.style.animationDuration = (900 + Math.random()*700) + 'ms';
      i.style.opacity = 0;
      confetti.appendChild(i);
      setTimeout(()=> i.remove(), 1700);
    }
    // Sounds
    if(who===PLAYER){
      chord([660,880,990], 0.16);
    }else{
      chord([330,392,494], 0.16);
    }
  }

  // Simple WebAudio beeps
  let audioCtx;
  function getCtx(){
    if(!audioCtx){
      try{ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
      catch(e){ audioCtx = null; }
    }
    return audioCtx;
  }
  function blip(freq=440, dur=0.08){
    const ctx = getCtx(); if(!ctx) return;
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type='sine'; o.frequency.value = freq;
    g.gain.value = 0.0001;
    o.connect(g).connect(ctx.destination);
    const t = ctx.currentTime;
    g.gain.exponentialRampToValueAtTime(0.15, t+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, t+dur);
    o.start(t); o.stop(t+dur+0.01);
  }
  function chord(freqs=[], dur=0.18){
    const ctx = getCtx(); if(!ctx) return;
    const t = ctx.currentTime;
    freqs.forEach((f,i)=>{
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine'; o.frequency.value = f;
      g.gain.value = 0.0001;
      o.connect(g).connect(ctx.destination);
      const start = t + i*0.02;
      g.gain.exponentialRampToValueAtTime(0.12, start+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, start+dur);
      o.start(start); o.stop(start+dur+0.02);
    });
  }

  newGameBtn.addEventListener('click', ()=> {
    over = false;
    winLine = null;
    board = Array(9).fill('');
    turn = PLAYER;
    render();
  }, {passive:true});

  resetScoreBtn.addEventListener('click', ()=> {
    scores = {S:0, M:0};
    saveScores(); updateScores();
    blip(280, 0.1);
  }, {passive:true});

  // Initial
  updateScores();
  render();

})();
</script>
</body>
</html>