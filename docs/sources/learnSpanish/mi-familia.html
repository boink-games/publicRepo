<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Árbol de Familia - Aprende Español</title>
<style>
  :root{
    --bg1:#f3f7ff;
    --bg2:#eaf2ff;
    --ink:#1f2d3d;
    --muted:#6b7a90;
    --accent:#4c7dff;
    --accent2:#ff6aa7;
    --accent3:#29c491;
    --good:#2cb67d;
    --bad:#ef4444;
    --card:#ffffffcc;
    --ring:#bcd0ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
    color:var(--ink);
    background: radial-gradient(1200px 600px at 20% 0%,var(--bg2),transparent),
                radial-gradient(1200px 600px at 80% 100%,#fef6ff,transparent),
                linear-gradient(180deg,#f7fbff, #f5faff);
  }
  .wrap{
    max-width: 1000px;
    margin: min(4vh,32px) auto;
    padding: clamp(10px,2vw,24px);
  }
  .card{
    background: var(--card);
    backdrop-filter: saturate(1.2) blur(6px);
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.5);
    overflow: hidden;
  }
  header{
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    padding: 14px 16px;
    border-bottom:1px solid rgba(0,0,0,.06);
    background: linear-gradient(180deg, rgba(255,255,255,.8), rgba(255,255,255,.5));
  }
  .title{
    display:flex;align-items:center;gap:12px;min-width:0;
  }
  .title h1{font-size:clamp(18px,2.6vw,24px);margin:0;white-space:nowrap}
  .subtitle{font-size:clamp(12px,1.4vw,14px);color:var(--muted)}
  .controls{
    display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:flex-end;
  }
  button, select{
    appearance:none;
    border:1px solid rgba(0,0,0,.12);
    background:#fff;
    color:var(--ink);
    padding:10px 12px;
    border-radius:10px;
    font-weight:600;
    letter-spacing:.2px;
    font-size:14px;
    box-shadow: 0 1px 0 rgba(255,255,255,.9) inset, 0 2px 6px rgba(0,0,0,.06);
    transition:.15s transform ease, .15s background ease, .15s box-shadow ease;
  }
  button:hover, select:hover{transform:translateY(-1px)}
  button:active{transform:translateY(0)}
  .accent{background:var(--accent); color:#fff; border-color:transparent}
  .ghost{background: #f7f9ff; border-color:#e4eaff}
  .muted{background:#f2f4f8; color:#42506a}
  .pill{border-radius:999px}
  .score{
    padding:6px 10px; border-radius:999px;
    background: #eef7ff; color:#1b4b9c; font-weight:800;
  }
  .bar{
    padding: 10px 16px;
    display:flex;
    gap:10px; align-items:center; justify-content:space-between;
    border-bottom:1px dashed rgba(0,0,0,.06);
  }
  .instructions{
    padding: 10px 16px 14px;
    color:var(--muted);
    font-size:14px;
    display:grid;
    gap:8px;
  }
  .instructions b{color:#234}
  .board{
    position:relative;
    width:100%;
    aspect-ratio: 1000 / 700;
    background: linear-gradient(180deg, #f8fbff, #f0f6ff);
  }
  svg{width:100%;height:100%;display:block}
  .node{cursor:pointer; outline:none;}
  .node .ring{
    fill: none; stroke-width: 12; stroke-linecap: round; opacity:.6;
    filter: drop-shadow(0 6px 10px rgba(0,0,0,.08));
  }
  .node .base{ stroke:#182033; stroke-opacity:.1}
  .node:focus .focus{
    opacity:1;
  }
  .focus{opacity:0; transition: .12s opacity ease}
  .node:hover .focus{opacity:1}
  .node:hover .face, .node:focus .face{
    transform: translateY(-2px);
  }
  .face{transition: transform .15s ease}
  .label{
    font-size: 28px; font-weight: 800; text-anchor: middle; fill: #1b2a3e;
  }
  .shadow{
    filter: drop-shadow(0 8px 16px rgba(0,0,0,.12));
  }
  .connector{stroke:#bcd0ff; stroke-width:10; fill:none; stroke-linecap:round}
  .connector.glow{stroke:#e3ecff; stroke-width:16; opacity:.8}
  .pulse{animation: pulse .35s ease}
  @keyframes pulse{
    0%{transform:translateY(0) scale(1)}
    50%{transform:translateY(-6px) scale(1.04)}
    100%{transform:translateY(0) scale(1)}
  }
  .shake{animation: shake .25s ease}
  @keyframes shake{
    0%,100%{transform:translateX(0)}
    25%{transform:translateX(-6px)}
    75%{transform:translateX(6px)}
  }
  .good{color:var(--good)}
  .bad{color:var(--bad)}
  .target{
    display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    font-weight:700;
  }
  .target .bubble{
    background:#ffffff;
    border: 2px solid #e5ecff;
    color:#15233a;
    padding: 6px 10px;
    border-radius: 10px;
  }
  .kbd{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-weight:800; font-size:12px;
    padding:2px 6px; border:1px solid #d8e2ff; border-radius:6px; background:#f7faff; color:#243250;
  }
  .footer{
    font-size:12px; color:#6d7a90; text-align:center; padding:10px 8px 14px;
  }
  .sr{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <header>
      <div class="title">
        <div style="width:38px;height:38px;background: conic-gradient(from 230deg at 60% 40%, #7aa2ff, #ff96c5, #7aa2ff 60%); border-radius:10px; box-shadow:inset 0 0 0 2px #fff; transform: rotate(-8deg)"></div>
        <div>
          <h1>Árbol de Familia</h1>
          <div class="subtitle">Toca o haz clic para escuchar en español</div>
        </div>
      </div>
      <div class="controls">
        <select id="voiceSelect" title="Seleccionar voz (Español)"></select>
        <button id="practiceBtn" class="ghost pill" aria-pressed="true">Modo: Práctica</button>
        <button id="challengeBtn" class="accent pill">Iniciar Reto</button>
      </div>
    </header>

    <div class="bar">
      <div class="target" id="targetBox">
        <span class="bubble">Consejo: usa las teclas <span class="kbd">1</span>, <span class="kbd">2</span>, <span class="kbd">3</span> o flechas + Enter</span>
      </div>
      <div class="score" id="scoreBox" aria-live="polite">Puntuación: 0</div>
    </div>

    <div class="instructions" id="instructions">
      <div><b>Cómo jugar:</b> Toca/cliqa un miembro de la familia para oír su nombre en español. En móviles, toca; en computadora, usa el ratón o el teclado.</div>
      <div>
        Atajos: 1 = el padre, 2 = la madre, 3 = el bebé. Usa flechas para seleccionar y Enter para escuchar.
      </div>
    </div>

    <div class="board" id="board">
      <svg viewBox="0 0 1000 700" role="img" aria-label="Árbol familiar interactivo en español">
        <defs>
          <linearGradient id="bgp" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#8fb6ff"/>
            <stop offset="1" stop-color="#4c7dff"/>
          </linearGradient>
          <linearGradient id="bgm" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#ffabc9"/>
            <stop offset="1" stop-color="#ff6aa7"/>
          </linearGradient>
          <linearGradient id="bgb" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#67e7b3"/>
            <stop offset="1" stop-color="#29c491"/>
          </linearGradient>
        </defs>

        <path class="connector glow" d="M300 280 C 320 420, 450 440, 500 480"/>
        <path class="connector glow" d="M700 280 C 680 420, 550 440, 500 480"/>
        <path class="connector" d="M300 280 C 320 420, 450 440, 500 480"/>
        <path class="connector" d="M700 280 C 680 420, 550 440, 500 480"/>

        <g id="padre" class="node" role="button" tabindex="0" aria-label="el padre" data-es="el padre" data-en="father" data-key="1" transform="translate(300,200)">
          <circle class="ring" cx="0" cy="0" r="86" stroke="url(#bgp)"></circle>
          <circle class="focus" cx="0" cy="0" r="96" fill="none" stroke="#a9c3ff" stroke-width="6"></circle>
          <g class="face shadow">
            <circle class="base" cx="0" cy="0" r="72" fill="#fee1c7"></circle>
            <rect x="-50" y="-78" width="100" height="46" rx="12" fill="#2e3a59"></rect>
            <circle cx="-28" cy="-6" r="6" fill="#2e3a59"></circle>
            <circle cx="28" cy="-6" r="6" fill="#2e3a59"></circle>
            <path d="M-18 16 Q0 28 18 16" fill="none" stroke="#c46a3b" stroke-width="6" stroke-linecap="round"/>
            <path d="M-20 8 Q0 18 20 8" stroke="#2e3a59" stroke-width="6" stroke-linecap="round" fill="none"/>
            <rect x="-14" y="60" width="28" height="22" rx="6" fill="#4c7dff"/>
            <path d="M0 82 L-10 102 L10 102 Z" fill="#2f53c7"/>
          </g>
          <text class="label" x="0" y="140">el padre <tspan fill="#6b7a90" font-size="16">(1)</tspan></text>
        </g>

        <g id="madre" class="node" role="button" tabindex="0" aria-label="la madre" data-es="la madre" data-en="mother" data-key="2" transform="translate(700,200)">
          <circle class="ring" cx="0" cy="0" r="86" stroke="url(#bgm)"></circle>
          <circle class="focus" cx="0" cy="0" r="96" fill="none" stroke="#ffc1da" stroke-width="6"></circle>
          <g class="face shadow">
            <circle class="base" cx="0" cy="0" r="72" fill="#ffe7d5"></circle>
            <path d="M-70 -10 Q0 -100 70 -10 Q40 10 -40 10 Z" fill="#c13d66"/>
            <circle cx="-26" cy="-6" r="6" fill="#2e3a59"></circle>
            <circle cx="26" cy="-6" r="6" fill="#2e3a59"></circle>
            <path d="M-18 18 Q0 28 18 18" fill="none" stroke="#d67858" stroke-width="6" stroke-linecap="round"/>
            <path d="M-36 -12 q8 -10 16 0 M20 -12 q8 -10 16 0" stroke="#2e3a59" stroke-width="3" fill="none" stroke-linecap="round"/>
            <rect x="-22" y="58" width="44" height="24" rx="8" fill="#ff6aa7"/>
          </g>
          <text class="label" x="0" y="140">la madre <tspan fill="#6b7a90" font-size="16">(2)</tspan></text>
        </g>

        <g id="bebe" class="node" role="button" tabindex="0" aria-label="el bebé" data-es="el bebé" data-en="baby" data-key="3" transform="translate(500,500)">
          <circle class="ring" cx="0" cy="0" r="86" stroke="url(#bgb)"></circle>
          <circle class="focus" cx="0" cy="0" r="96" fill="none" stroke="#a8f0d3" stroke-width="6"></circle>
          <g class="face shadow">
            <circle class="base" cx="0" cy="0" r="72" fill="#ffe9d9"></circle>
            <path d="M-6 -60 Q0 -75 6 -60" stroke="#a37146" stroke-width="6" fill="none" stroke-linecap="round"/>
            <circle cx="-22" cy="-6" r="6" fill="#2e3a59"></circle>
            <circle cx="22" cy="-6" r="6" fill="#2e3a59"></circle>
            <path d="M-12 18 Q0 12 12 18" fill="none" stroke="#d07b52" stroke-width="6" stroke-linecap="round"/>
            <circle cx="0" cy="32" r="12" fill="#7fd9b1" stroke="#3aa879" stroke-width="4"></circle>
            <circle cx="0" cy="32" r="4" fill="#3aa879"></circle>
          </g>
          <text class="label" x="0" y="140">el bebé <tspan fill="#6b7a90" font-size="16">(3)</tspan></text>
        </g>
      </svg>
    </div>

    <div class="footer">
      Toca los iconos para escuchar. Si no oyes la voz, elige otra voz de "Seleccionar voz". Compatible con la mayoría de navegadores modernos.
    </div>
  </div>
</div>

<div id="live" class="sr" aria-live="polite"></div>

<script>
(function(){
  const nodes = [
    {id:'padre', es:'el padre', en:'father'},
    {id:'madre', es:'la madre', en:'mother'},
    {id:'bebe',  es:'el bebé',  en:'baby'}
  ];
  const order = ['padre','madre','bebe'];
  const neighbor = {
    padre:{left:'bebe', right:'madre', up:'padre', down:'bebe'},
    madre:{left:'padre', right:'bebe', up:'madre', down:'bebe'},
    bebe:{left:'padre', right:'madre', up:'padre', down:'bebe'}
  };

  const voiceSelect = document.getElementById('voiceSelect');
  const practiceBtn = document.getElementById('practiceBtn');
  const challengeBtn = document.getElementById('challengeBtn');
  const targetBox = document.getElementById('targetBox');
  const scoreBox = document.getElementById('scoreBox');
  const live = document.getElementById('live');
  let currentMode = 'practice';
  let score = 0;
  let targetId = null;
  let voices = [];
  let chosenVoice = null;

  function populateVoices(){
    voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
    const esVoices = voices.filter(v => (v.lang || '').toLowerCase().startsWith('es'));
    voiceSelect.innerHTML = '';
    if(esVoices.length){
      esVoices.forEach((v, i)=>{
        const opt = document.createElement('option');
        opt.value = v.name;
        opt.textContent = `${v.name} (${v.lang})`;
        voiceSelect.appendChild(opt);
      });
      // Prefer es-ES, else first
      const preferred = esVoices.find(v => v.lang.toLowerCase().includes('es-es')) || esVoices[0];
      chosenVoice = preferred;
      voiceSelect.value = preferred.name;
    }else{
      const opt = document.createElement('option');
      opt.value = '';
      opt.textContent = 'Voz predeterminada (es-ES)';
      voiceSelect.appendChild(opt);
      chosenVoice = null;
    }
  }

  function speak(text){
    if(!('speechSynthesis' in window)) { feedback('Tu navegador no soporta voz.'); return; }
    try{
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'es-ES';
      u.rate = 0.95;
      u.pitch = 1.05;
      if(chosenVoice){
        const match = voices.find(v=>v.name===chosenVoice.name);
        if(match) u.voice = match;
      }
      speechSynthesis.speak(u);
    }catch(e){}
  }

  function feedback(msg){
    live.textContent = msg;
  }

  function setMode(mode){
    currentMode = mode;
    if(mode==='practice'){
      practiceBtn.setAttribute('aria-pressed','true');
      practiceBtn.classList.add('ghost');
      challengeBtn.textContent = 'Iniciar Reto';
      targetBox.innerHTML = `<span class="bubble">Consejo: usa las teclas <span class="kbd">1</span>, <span class="kbd">2</span>, <span class="kbd">3</span> o flechas + Enter</span>`;
      score = 0;
      scoreBox.textContent = 'Puntuación: 0';
      targetId = null;
    }else{
      practiceBtn.setAttribute('aria-pressed','false');
      practiceBtn.classList.remove('ghost');
      challengeBtn.textContent = 'Reto en curso (reiniciar)';
      score = 0;
      scoreBox.textContent = 'Puntuación: 0';
      nextTarget();
    }
  }

  function nextTarget(){
    const ids = order.slice();
    if(targetId){
      // avoid repeating
      const idx = ids.indexOf(targetId);
      if(idx>=0) ids.splice(idx,1);
    }
    targetId = ids[Math.floor(Math.random()*ids.length)];
    const member = nodes.find(n=>n.id===targetId);
    targetBox.innerHTML = `
      <span>Busca:</span>
      <span class="bubble"><b>${member.es}</b> · ${member.en}</span>
      <button id="hearBtn" class="muted pill" style="font-weight:700">Escuchar</button>
    `;
    document.getElementById('hearBtn').addEventListener('click', ()=>{
      speak(member.es);
      pulse(targetId);
    }, {passive:true});
  }

  function pulse(id){
    const g = document.getElementById(id);
    if(!g) return;
    g.classList.remove('pulse');
    // Force reflow
    void g.offsetWidth;
    g.classList.add('pulse');
  }

  function shake(id){
    const g = document.getElementById(id);
    if(!g) return;
    g.classList.remove('shake');
    void g.offsetWidth;
    g.classList.add('shake');
  }

  function handleSelect(id){
    const g = document.getElementById(id);
    if(!g) return;
    const term = g.getAttribute('data-es');
    speak(term);
    pulse(id);
    if(currentMode==='challenge'){
      if(id===targetId){
        score++;
        scoreBox.textContent = `Puntuación: ${score}`;
        targetBox.innerHTML = `<span class="good" style="font-weight:800">¡Correcto!</span> <span class="bubble"><b>${term}</b></span>`;
        setTimeout(nextTarget, 850);
      }else{
        shake(id);
        targetBox.innerHTML = `<span class="bad" style="font-weight:800">Inténtalo de nuevo</span> <span class="bubble"><b>${nodes.find(n=>n.id===targetId).es}</b></span>`;
      }
    }
  }

  function focusNode(id){
    const g = document.getElementById(id);
    if(g){ g.focus({preventScroll:true}); }
  }

  // Attach interactions
  order.forEach(id=>{
    const g = document.getElementById(id);
    g.addEventListener('click', ()=>handleSelect(id));
    g.addEventListener('pointerdown', (e)=>{ /* for mobile active */ });
    g.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){
        e.preventDefault();
        handleSelect(id);
      }else if(e.key==='ArrowLeft' || e.key==='ArrowRight' || e.key==='ArrowUp' || e.key==='ArrowDown'){
        e.preventDefault();
        const next = neighbor[id][e.key.replace('Arrow','').toLowerCase()];
        focusNode(next);
      }
    });
  });

  // Global keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    const key = e.key;
    if(key==='1'){ handleSelect('padre'); }
    if(key==='2'){ handleSelect('madre'); }
    if(key==='3'){ handleSelect('bebe'); }
  });

  // Buttons
  practiceBtn.addEventListener('click', ()=>{
    setMode(currentMode==='practice' ? 'challenge' : 'practice');
  });
  challengeBtn.addEventListener('click', ()=>{
    setMode('challenge');
  });

  // Voice handling
  populateVoices();
  if('speechSynthesis' in window){
    speechSynthesis.onvoiceschanged = ()=>{
      populateVoices();
    };
  }
  voiceSelect.addEventListener('change', ()=>{
    const name = voiceSelect.value;
    chosenVoice = voices.find(v=>v.name===name) || null;
    const sample = targetId ? nodes.find(n=>n.id===targetId).es : 'Bienvenido';
    speak(sample);
  });

  // Accessibility: initial focus
  setTimeout(()=>focusNode('padre'), 300);

  // iOS warm-up: speak after first user gesture if needed
  let warmed = false;
  function warm(){
    if(warmed) return;
    warmed = true;
    if(currentMode==='practice'){
      // gentle cue without speaking loudly: do nothing or small utterance
    }
  }
  window.addEventListener('pointerdown', warm, {once:true, passive:true});
})();
</script>
</body>
</html>