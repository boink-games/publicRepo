<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>¬øQu√© tiempo hace? - Juego de clima en espa√±ol</title>
<meta name="color-scheme" content="light">
<style>
:root{
  --bg1:#f7f9ff;
  --bg2:#e7f2ff;
  --ink:#1e2a35;
  --muted:#567086;
  --accent:#ffb703;
  --accent-2:#2196f3;
  --accent-3:#8e5cf6;
  --good:#2ecc71;
  --card:#ffffffcc;
  --shadow: 0 12px 30px rgba(0,0,0,.12);
  --radius: 24px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
  color:var(--ink);
  background: radial-gradient(1200px 600px at 20% -10%, #ffffff 10%, var(--bg2) 50%, var(--bg1) 100%);
  display:flex;
  align-items:center;
  justify-content:center;
}
#app{
  width:min(100%, 980px);
  padding: clamp(12px, 2vw, 24px);
}
header{
  text-align:center;
  margin-bottom: clamp(8px, 1.5vw, 16px);
}
h1{
  margin:0;
  font-weight:800;
  font-size:clamp(28px, 4.5vw, 48px);
  letter-spacing:.5px;
}
.subtitle{
  margin:.25rem 0 0;
  color:var(--muted);
  font-size: clamp(14px, 2.5vw, 18px);
}
.main{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: clamp(14px, 2.5vw, 22px);
}
.stage{
  position:relative;
  width:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: clamp(8px, 2vw, 16px);
}
.card{
  position:relative;
  background: linear-gradient(180deg, #fff, #fafcff);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: clamp(12px, 2.5vw, 24px);
  width: min(92vw, 580px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap: clamp(10px, 2vw, 16px);
  user-select:none;
}
.icon-btn{
  background: linear-gradient(180deg, #ffffff, #f6f8fb);
  border: 0;
  border-radius: clamp(18px, 4vw, 32px);
  box-shadow: inset 0 2px 6px rgba(0,0,0,.04), 0 8px 20px rgba(0,0,0,.08);
  width: min(80vw, 420px);
  height: min(70vh, 420px);
  max-height: 60vh;
  display:flex;
  align-items:center;
  justify-content:center;
  transition: transform .15s ease, box-shadow .2s ease;
  touch-action: manipulation;
  position:relative;
  overflow:hidden;
}
.icon-btn:active{ transform: scale(.99) }
.icon-wrap{
  width: 78%;
  height: 78%;
  display:flex;
  align-items:center;
  justify-content:center;
}
.word{
  font-weight: 800;
  font-size: clamp(28px, 5vw, 44px);
  letter-spacing: .5px;
  color: var(--ink);
}
.glow{
  position:absolute;
  inset:auto 0 0 0;
  height: 22%;
  background: radial-gradient(50% 90% at 50% 0%, rgba(33,150,243,.18), rgba(33,150,243,0) 70%);
  pointer-events:none;
}
.hint{
  color: var(--muted);
  font-size: clamp(12px, 2.2vw, 15px);
}
.controls{
  display:flex;
  gap: 12px;
  flex-wrap: wrap;
  justify-content:center;
}
button.ui{
  border:0;
  padding: 12px 16px;
  border-radius: 12px;
  background:#fff;
  box-shadow: 0 6px 14px rgba(0,0,0,.08);
  color:var(--ink);
  font-weight:700;
  font-size: 16px;
  display:inline-flex;
  align-items:center;
  gap:10px;
}
button.ui:active{ transform: translateY(1px) }
.nav{
  position:absolute;
  top:50%;
  transform: translateY(-50%);
  background:#ffffffd9;
  border:0;
  box-shadow: 0 6px 16px rgba(0,0,0,.12);
  width: 46px; height: 46px;
  border-radius: 50%;
  display:flex; align-items:center; justify-content:center;
  font-size:22px; font-weight:900;
  color:var(--ink);
  z-index:5;
  touch-action: manipulation;
}
.nav:active{ transform: translateY(-50%) scale(.98) }
.nav.prev{ left: clamp(6px, 2vw, 16px) }
.nav.next{ right: clamp(6px, 2vw, 16px) }

.badge{
  font-size: 12px;
  color: #fff;
  background: linear-gradient(90deg, var(--accent-2), #63a4ff);
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 800;
  letter-spacing:.4px;
}

.instructions{
  text-align:center;
  color:var(--muted);
  margin-top: 6px;
  font-size: clamp(12px, 2.3vw, 15px);
}

footer{
  margin-top: 14px;
  text-align:center;
  color: var(--muted);
  font-size: 12px;
}

/* Icon styles & animations */
svg{ width:100%; height:100%; }
.sun-core{ fill:#ffcd38 }
.ray{ stroke:#ffb703; stroke-width:10; stroke-linecap:round; filter: drop-shadow(0 2px 0 rgba(0,0,0,.05)); }
.cloud{ fill:#e6ecf5; }
.cloud-dark{ fill:#dbe4ef; }
.rain{ fill:#2da3ff; }
.snow{ fill:#8ec9ff }
.flake-line{ stroke:#8ec9ff; stroke-width:6; stroke-linecap:round }

.pop{
  animation: pop .45s ease;
}
@keyframes pop{
  0%{ transform: scale(1) }
  30%{ transform: scale(1.04) }
  60%{ transform: scale(.98) }
  100%{ transform: scale(1) }
}
.float{
  animation: float 3s ease-in-out infinite;
}
@keyframes float{
  0%,100%{ transform: translateY(0) }
  50%{ transform: translateY(-6px) }
}

/* Overlay gate for audio permission */
#gate{
  position: fixed;
  inset:0;
  background: linear-gradient(180deg, #ffffff, #eef6ff);
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 24px;
  z-index: 20;
}
.gate-card{
  width: min(92vw, 520px);
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 14px 36px rgba(0,0,0,.14);
  padding: clamp(18px, 4vw, 28px);
  text-align:center;
}
.gate-card h2{
  margin: 4px 0 8px;
  font-size: clamp(22px, 4vw, 30px);
}
.gate-card p{
  margin: 6px 0;
  color: var(--muted);
  font-size: clamp(14px, 2.8vw, 16px);
}
.big-start{
  margin-top: 12px;
  padding: 14px 20px;
  font-size: clamp(16px, 3.2vw, 18px);
  border:0; border-radius: 14px;
  background: linear-gradient(90deg, #ffb703, #ffd166);
  color:#2a2a2a; font-weight:900;
  box-shadow: 0 10px 18px rgba(255,183,3,.3);
}
.big-start:active{ transform: translateY(1px) }

/* Accessibility focus */
button:focus-visible, .icon-btn:focus-visible{
  outline: 3px solid #74b0ff;
  outline-offset: 2px;
}
.hidden{ display:none !important }
</style>
</head>
<body>
<div id="app" aria-live="polite">
  <header>
    <div class="badge">Juego en espa√±ol</div>
    <h1>¬øQu√© tiempo hace?</h1>
    <p class="subtitle">Toca o haz clic en la imagen grande para escuchar la palabra en espa√±ol.</p>
  </header>

  <div class="main">
    <div class="stage">
      <button class="nav prev" id="prevBtn" aria-label="Anterior" title="Anterior">‚óÄ</button>
      <div class="card" id="card">
        <button class="icon-btn" id="iconBtn" aria-label="Reproducir palabra">
          <div class="icon-wrap float" id="icon"></div>
          <div class="glow"></div>
        </button>
        <div class="word" id="word">‚Äî</div>
        <div class="hint" id="hint">Pulsa el bot√≥n de inicio para activar el sonido.</div>
      </div>
      <button class="nav next" id="nextBtn" aria-label="Siguiente" title="Siguiente">‚ñ∂</button>
    </div>

    <div class="controls">
      <button class="ui" id="repeatBtn" aria-label="Escuchar de nuevo">üîä Escuchar</button>
      <button class="ui" id="shuffleBtn" aria-label="Siguiente clima">‚û°Ô∏è Siguiente</button>
    </div>

    <div class="instructions">
      C√≥mo jugar: toca la imagen para o√≠r la palabra. Teclas: Espacio = escuchar, ‚Üê/‚Üí = cambiar. En m√≥viles, desliza para cambiar.
    </div>
  </div>

  <footer>Hecho con cari√±o para peque√±os aprendices ‚òÄÔ∏è</footer>
</div>

<div id="gate" role="dialog" aria-modal="true" aria-labelledby="gTitle">
  <div class="gate-card">
    <h2 id="gTitle">¬°Hola! Vamos a aprender el clima en espa√±ol</h2>
    <p>Para poder hablar en voz alta, tu dispositivo necesita que toques el bot√≥n de inicio.</p>
    <p>Luego, toca la imagen para escuchar la palabra. Desliza o usa las flechas para cambiar.</p>
    <button class="big-start" id="startBtn">Comenzar y activar sonido</button>
  </div>
</div>

<script>
const weathers = [
  {
    key: 'sun',
    es: 'sol',
    en: 'sun',
    color: '#ffb703',
    svg: () => `
      <svg viewBox="0 0 256 256" aria-hidden="true">
        <defs>
          <radialGradient id="gSun" cx="50%" cy="50%" r="60%">
            <stop offset="0%" stop-color="#fff59d"/>
            <stop offset="60%" stop-color="#ffec6e"/>
            <stop offset="100%" stop-color="#ffcd38"/>
          </radialGradient>
        </defs>
        <circle cx="128" cy="128" r="54" fill="url(#gSun)" class="sun-core"/>
        ${Array.from({length:12}).map((_,i)=>{
          const a = (i/12)*Math.PI*2;
          const x1 = 128 + Math.cos(a)*74;
          const y1 = 128 + Math.sin(a)*74;
          const x2 = 128 + Math.cos(a)*102;
          const y2 = 128 + Math.sin(a)*102;
          return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" class="ray"/>`;
        }).join('')}
      </svg>
    `
  },
  {
    key: 'rain',
    es: 'lluvia',
    en: 'rain',
    color: '#2196f3',
    svg: () => `
      <svg viewBox="0 0 256 256" aria-hidden="true">
        <g>
          <ellipse cx="124" cy="110" rx="70" ry="42" class="cloud"/>
          <ellipse cx="168" cy="116" rx="54" ry="34" class="cloud-dark"/>
          <ellipse cx="88" cy="120" rx="52" ry="30" class="cloud-dark"/>
        </g>
        <g>
          ${[70, 102, 134, 166, 198].map((x,i)=>`
            <path d="M${x} 152 q6 8 0 18 q-6 10 -12 0 q-6 -10 0 -18 q6 -8 12 0z" class="rain" transform="scale(1 ${1 + (i%2?0.05:0)})"/>
          `).join('')}
        </g>
      </svg>
    `
  },
  {
    key: 'clouds',
    es: 'nubes',
    en: 'clouds',
    color: '#8e9eb5',
    svg: () => `
      <svg viewBox="0 0 256 256" aria-hidden="true">
        <g>
          <ellipse cx="120" cy="124" rx="76" ry="42" class="cloud"/>
          <ellipse cx="168" cy="130" rx="64" ry="38" class="cloud-dark"/>
          <ellipse cx="76" cy="134" rx="54" ry="32" class="cloud-dark"/>
        </g>
      </svg>
    `
  },
  {
    key: 'snow',
    es: 'nieve',
    en: 'snow',
    color: '#7ecbff',
    svg: () => `
      <svg viewBox="0 0 256 256" aria-hidden="true">
        <g>
          <ellipse cx="126" cy="106" rx="70" ry="40" class="cloud"/>
          <ellipse cx="168" cy="112" rx="54" ry="32" class="cloud-dark"/>
          <ellipse cx="88" cy="116" rx="50" ry="28" class="cloud-dark"/>
        </g>
        <g>
          ${[86,116,146,176].map((x,i)=>`
            <g transform="translate(${x},160)">
              <line x1="-10" y1="0" x2="10" y2="0" class="flake-line"/>
              <line x1="0" y1="-10" x2="0" y2="10" class="flake-line"/>
              <line x1="-7" y1="-7" x2="7" y2="7" class="flake-line"/>
            </g>
          `).join('')}
        </g>
      </svg>
    `
  }
];

const iconEl = document.getElementById('icon');
const wordEl = document.getElementById('word');
const hintEl = document.getElementById('hint');
const iconBtn = document.getElementById('iconBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const repeatBtn = document.getElementById('repeatBtn');
const shuffleBtn = document.getElementById('shuffleBtn');
const gate = document.getElementById('gate');
const startBtn = document.getElementById('startBtn');

let idx = Math.floor(Math.random()*weathers.length);
let voices = [];
let chosenVoice = null;
let audioReady = false;
let lastTouch = {x:0,y:0,t:0};

function render(){
  const w = weathers[idx];
  iconEl.innerHTML = w.svg();
  wordEl.textContent = capitalize(w.es);
  iconBtn.style.setProperty('--accent-color', w.color);
  iconBtn.classList.remove('pop'); void iconBtn.offsetWidth; iconBtn.classList.add('pop');
  setTimeout(()=> speak(w.es), 250);
}

function capitalize(s){ return s.charAt(0).toUpperCase() + s.slice(1); }

function pickSpanishVoice(){
  const v = voices;
  let preferred = v.find(x => x.lang && x.lang.toLowerCase().startsWith('es') && x.localService);
  if (!preferred) preferred = v.find(x => x.lang && x.lang.toLowerCase().startsWith('es'));
  if (!preferred) preferred = v.find(x => x.lang && x.lang.toLowerCase().includes('es'));
  if (!preferred && v.length) preferred = v[0];
  chosenVoice = preferred || null;
}

function warmupSynth(){
  try {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(' ');
    u.volume = 0;
    window.speechSynthesis.speak(u);
  } catch(e){}
}

function speak(text){
  if (!audioReady) return;
  try{
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = chosenVoice?.lang || 'es-ES';
    u.voice = chosenVoice || null;
    u.rate = 0.9;
    u.pitch = 1.05;
    u.volume = 1;
    iconBtn.classList.remove('pop'); void iconBtn.offsetWidth; iconBtn.classList.add('pop');
    window.speechSynthesis.speak(u);
  }catch(e){}
}

function next(){
  idx = (idx + 1) % weathers.length;
  render();
}
function prev(){
  idx = (idx - 1 + weathers.length) % weathers.length;
  render();
}
function shuffle(){
  let n;
  do { n = Math.floor(Math.random()*weathers.length) } while(n === idx);
  idx = n;
  render();
}

function initVoices(){
  voices = window.speechSynthesis.getVoices();
  pickSpanishVoice();
}

function prepareAudio(){
  warmupSynth();
  initVoices();
  audioReady = true;
  gate.classList.add('hidden');
  hintEl.textContent = 'Toca la imagen para escuchar. Desliza o usa ‚Üê/‚Üí para cambiar.';
  render();
}

startBtn.addEventListener('click', prepareAudio, {passive:true});
window.addEventListener('keydown', (e)=>{
  if (!audioReady) {
    if (e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      prepareAudio();
    }
    return;
  }
  if (e.key === ' ' || e.code === 'Space'){
    e.preventDefault();
    speak(weathers[idx].es);
  } else if (e.key === 'ArrowRight'){
    e.preventDefault(); next();
  } else if (e.key === 'ArrowLeft'){
    e.preventDefault(); prev();
  } else if (e.key.toLowerCase() === 'r'){
    e.preventDefault(); speak(weathers[idx].es);
  }
});

iconBtn.addEventListener('click', ()=> speak(weathers[idx].es));
repeatBtn.addEventListener('click', ()=> speak(weathers[idx].es));
shuffleBtn.addEventListener('click', shuffle);
nextBtn.addEventListener('click', next);
prevBtn.addEventListener('click', prev);

['touchstart','pointerdown','mousedown'].forEach(evt=>{
  iconBtn.addEventListener(evt, ()=>{ if(!audioReady) prepareAudio(); }, {passive:true});
});

const stage = document.querySelector('.card');
stage.addEventListener('touchstart', (e)=>{
  const t = e.changedTouches[0];
  lastTouch = {x:t.clientX, y:t.clientY, t: Date.now()};
},{passive:true});
stage.addEventListener('touchend', (e)=>{
  const t = e.changedTouches[0];
  const dx = t.clientX - lastTouch.x;
  const dy = t.clientY - lastTouch.y;
  const dt = Date.now() - lastTouch.t;
  if (Math.abs(dx) > 40 && Math.abs(dx) > Math.abs(dy) && dt < 600){
    if (dx < 0) next(); else prev();
  } else {
    // Treat as tap to speak if ended on icon area
    const rect = iconBtn.getBoundingClientRect();
    if (t.clientX>=rect.left && t.clientX<=rect.right && t.clientY>=rect.top && t.clientY<=rect.bottom){
      speak(weathers[idx].es);
    }
  }
},{passive:true});

if ('speechSynthesis' in window){
  window.speechSynthesis.addEventListener('voiceschanged', ()=>{
    initVoices();
  });
} else {
  hintEl.textContent = 'Tu navegador no soporta voz. A√∫n puedes jugar leyendo la palabra.';
  gate.classList.add('hidden');
  audioReady = false;
  render = function(){
    const w = weathers[idx];
    iconEl.innerHTML = w.svg();
    wordEl.textContent = capitalize(w.es);
    iconBtn.classList.remove('pop'); void iconBtn.offsetWidth; iconBtn.classList.add('pop');
  };
  render();
}

initVoices();
iconEl.innerHTML = weathers[idx].svg();
wordEl.textContent = '‚Äî';
</script>
</body>
</html>