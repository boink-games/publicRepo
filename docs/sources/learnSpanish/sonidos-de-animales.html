<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sonidos de Animales</title>
<style>
  :root{
    --bg1:#fdf7ff;
    --bg2:#e6f7ff;
    --accent:#ff6b6b;
    --text:#2a2a2a;
    --muted:#6c6c6c;
  }
  html,body{
    height:100%;
  }
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 10% 0%, #fff2f6, transparent 60%),
      radial-gradient(1200px 600px at 90% 0%, #f0fffb, transparent 60%),
      radial-gradient(1200px 800px at 50% 100%, #eef3ff, transparent 60%),
      linear-gradient(180deg, #ffffff, #f7fbff 40%, #f5f5ff);
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .wrap{
    width:min(1000px, 95vw);
    padding:clamp(12px, 2.5vw, 24px);
  }
  header{
    text-align:center;
    margin-bottom: clamp(14px, 2.5vh, 24px);
  }
  h1{
    margin:0 0 8px 0;
    font-weight:800;
    letter-spacing:.5px;
    font-size: clamp(28px, 5.5vw, 44px);
    background: linear-gradient(90deg, #7b4cff, #ff5fa2 60%, #ffa35f);
    -webkit-background-clip:text;
    background-clip:text;
    color:transparent;
  }
  .instr{
    margin:0 auto;
    max-width: 720px;
    color:var(--muted);
    font-size: clamp(14px, 2.8vw, 18px);
  }
  .grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0,1fr));
    gap:clamp(12px, 2.5vw, 22px);
  }
  @media (max-width: 760px){
    .grid{
      grid-template-columns: 1fr;
    }
  }

  .animal-card{
    position:relative;
    isolation:isolate;
    border:none;
    cursor:pointer;
    border-radius:24px;
    padding: clamp(12px, 3vw, 18px);
    background: linear-gradient(180deg, #ffffff, #f5f8ff);
    box-shadow:
      0 8px 26px rgba(63, 91, 135, .14),
      inset 0 0 0 1px rgba(80,100,120,.08);
    display:grid;
    grid-template-rows: 1fr auto;
    align-items:center;
    min-height: clamp(180px, 32vw, 320px);
    transition: transform .12s ease, box-shadow .2s ease;
    touch-action: manipulation;
    outline: none;
  }
  .animal-card:active{
    transform: scale(.98);
    box-shadow:
      0 6px 18px rgba(63, 91, 135, .18),
      inset 0 0 0 1px rgba(80,100,120,.12);
  }
  .animal-card:focus-visible{
    box-shadow:
      0 10px 28px rgba(63, 91, 135, .2),
      inset 0 0 0 2px #6aa9ff,
      0 0 0 6px rgba(106,169,255,.2);
  }
  .circle{
    position:relative;
    place-self:center;
    width: clamp(140px, 35vw, 230px);
    aspect-ratio:1/1;
    border-radius:50%;
    display:grid;
    place-items:center;
    box-shadow: inset 0 10px 30px rgba(0,0,0,.05), 0 8px 18px rgba(0,0,0,.06);
    transition: transform .2s ease;
  }
  .animal-card:active .circle{
    transform: scale(.96);
  }
  .label{
    margin-top: clamp(10px, 2vw, 14px);
    text-align:center;
    font-size: clamp(18px, 4.2vw, 28px);
    font-weight:800;
    letter-spacing:.4px;
    text-transform: lowercase;
  }
  .hint{
    position:absolute;
    top:10px; right:10px;
    background: rgba(255,255,255,.8);
    border:1px solid rgba(0,0,0,.06);
    box-shadow:0 3px 10px rgba(0,0,0,.08);
    padding:.25rem .5rem;
    border-radius: 999px;
    font-weight:700;
    font-size: 13px;
    color:#5a5a5a;
    backdrop-filter: blur(6px);
  }

  /* Sparkle burst */
  .sparkle{
    position:absolute;
    inset:0;
    pointer-events:none;
    z-index: 3;
  }
  .sparkle i{
    position:absolute;
    width:10px; height:10px;
    border-radius:50%;
    opacity:0;
    transform: translate(-50%,-50%) scale(.2);
  }
  .sparkle i.fly{
    animation: fly .7s ease-out forwards;
  }
  @keyframes fly{
    0%{ opacity:0; transform: translate(-50%,-50%) scale(.2);}
    20%{ opacity:1;}
    100%{ opacity:0; transform: translate(var(--dx), var(--dy)) scale(1);}
  }

  /* Overlay to activar sonido */
  .overlay{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(240,247,255,.9));
    backdrop-filter: blur(6px);
    z-index: 100;
  }
  .overlay.show{ display:flex; }
  .start-card{
    background:#fff;
    border-radius:20px;
    padding:24px 20px;
    width:min(420px, 88vw);
    text-align:center;
    box-shadow: 0 10px 30px rgba(60, 80, 120, .2), inset 0 0 0 1px rgba(0,0,0,.06);
  }
  .start-title{
    font-size: 22px;
    font-weight:800;
    margin-bottom:8px;
  }
  .start-sub{
    color:#666;
    font-size: 15px;
    margin-bottom:16px;
  }
  .start-btn{
    border:none;
    background: linear-gradient(90deg, #7b4cff, #ff5fa2);
    color:#fff;
    font-weight:800;
    padding:12px 18px;
    border-radius:14px;
    cursor:pointer;
    width:100%;
    font-size: 16px;
    transition: transform .08s ease, box-shadow .2s ease;
    box-shadow: 0 8px 18px rgba(127, 76, 255,.25);
  }
  .start-btn:active{ transform: translateY(1px) scale(.99); }

  footer{
    margin-top: 14px;
    text-align:center;
    color:#8a8a8a;
    font-size: 12px;
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Sonidos de Animales</h1>
    <p class="instr">Toca un animal para escuchar su sonido y su nombre en español. También puedes usar el teclado: 1 = perro, 2 = gato, 3 = vaca. Usa las flechas para moverte y Enter o Espacio para reproducir.</p>
  </header>

  <section class="grid" id="grid" aria-label="Animales">
    <!-- Perro -->
    <button class="animal-card" data-id="perro" data-key="1" aria-label="perro">
      <div class="hint">1</div>
      <div class="circle" style="background: radial-gradient(120px 120px at 30% 25%, #ffe9a8, #ffd166);">
        <svg viewBox="0 0 200 200" width="78%" height="78%" aria-hidden="true">
          <defs>
            <radialGradient id="dogFace" cx="50%" cy="40%" r="70%">
              <stop offset="0%" stop-color="#fff0d4"/>
              <stop offset="100%" stop-color="#f6c98a"/>
            </radialGradient>
          </defs>
          <g>
            <!-- ears -->
            <path d="M55 36 C30 15, 15 50, 42 75 Q60 54 55 36Z" fill="#a36c3d"/>
            <path d="M145 36 C170 15, 185 50, 158 75 Q140 54 145 36Z" fill="#a36c3d"/>
            <!-- face -->
            <circle cx="100" cy="100" r="70" fill="url(#dogFace)" stroke="#c48a52" stroke-opacity=".2"/>
            <!-- spots -->
            <ellipse cx="70" cy="85" rx="28" ry="22" fill="#905f35" opacity=".28"/>
            <!-- eyes -->
            <circle cx="75" cy="100" r="6" fill="#2a2a2a"/>
            <circle cx="125" cy="100" r="6" fill="#2a2a2a"/>
            <!-- nose -->
            <path d="M98 118 q2 -4 4 0 q-2 10 -4 0Z" fill="#2a2a2a"/>
            <ellipse cx="100" cy="120" rx="10" ry="8" fill="#2a2a2a"/>
            <!-- mouth -->
            <path d="M85 132 q15 18 30 0" stroke="#2a2a2a" stroke-width="5" fill="none" stroke-linecap="round"/>
          </g>
        </svg>
      </div>
      <div class="label">perro</div>
      <div class="sparkle"></div>
    </button>

    <!-- Gato -->
    <button class="animal-card" data-id="gato" data-key="2" aria-label="gato">
      <div class="hint">2</div>
      <div class="circle" style="background: radial-gradient(120px 120px at 30% 25%, #d6f1ff, #a8dadc);">
        <svg viewBox="0 0 200 200" width="78%" height="78%" aria-hidden="true">
          <defs>
            <radialGradient id="catFace" cx="50%" cy="40%" r="70%">
              <stop offset="0%" stop-color="#ffffff"/>
              <stop offset="100%" stop-color="#d4e7ff"/>
            </radialGradient>
          </defs>
          <g>
            <!-- ears -->
            <path d="M60 45 L35 10 L70 30 Z" fill="#8aa0c9"/>
            <path d="M140 45 L165 10 L130 30 Z" fill="#8aa0c9"/>
            <!-- face -->
            <circle cx="100" cy="105" r="70" fill="url(#catFace)" stroke="#7a91bb" stroke-opacity=".25"/>
            <!-- eyes -->
            <ellipse cx="78" cy="110" rx="6" ry="7" fill="#2a2a2a"/>
            <ellipse cx="122" cy="110" rx="6" ry="7" fill="#2a2a2a"/>
            <!-- nose -->
            <polygon points="100,123 94,131 106,131" fill="#ff7aa2"/>
            <!-- mouth -->
            <path d="M100 132 q-12 12 -22 0" stroke="#6b6b6b" stroke-width="4" fill="none" stroke-linecap="round"/>
            <path d="M100 132 q12 12 22 0" stroke="#6b6b6b" stroke-width="4" fill="none" stroke-linecap="round"/>
            <!-- whiskers -->
            <path d="M55 120 h30" stroke="#7b8aa6" stroke-width="3" stroke-linecap="round"/>
            <path d="M55 130 h30" stroke="#7b8aa6" stroke-width="3" stroke-linecap="round"/>
            <path d="M115 120 h30" stroke="#7b8aa6" stroke-width="3" stroke-linecap="round"/>
            <path d="M115 130 h30" stroke="#7b8aa6" stroke-width="3" stroke-linecap="round"/>
          </g>
        </svg>
      </div>
      <div class="label">gato</div>
      <div class="sparkle"></div>
    </button>

    <!-- Vaca -->
    <button class="animal-card" data-id="vaca" data-key="3" aria-label="vaca">
      <div class="hint">3</div>
      <div class="circle" style="background: radial-gradient(120px 120px at 35% 25%, #dcffd6, #b7e4c7);">
        <svg viewBox="0 0 200 200" width="78%" height="78%" aria-hidden="true">
          <defs>
            <radialGradient id="cowFace" cx="50%" cy="40%" r="70%">
              <stop offset="0%" stop-color="#fff"/>
              <stop offset="100%" stop-color="#f2fff1"/>
            </radialGradient>
          </defs>
          <g>
            <!-- horns -->
            <path d="M60 50 q-28 -20 -28 10 q14 -6 28 -10Z" fill="#d2c5ac"/>
            <path d="M140 50 q28 -20 28 10 q-14 -6 -28 -10Z" fill="#d2c5ac"/>
            <!-- ears -->
            <ellipse cx="50" cy="75" rx="18" ry="12" fill="#d6a0a0"/>
            <ellipse cx="150" cy="75" rx="18" ry="12" fill="#d6a0a0"/>
            <!-- face -->
            <circle cx="100" cy="105" r="70" fill="url(#cowFace)" stroke="#a8c3a8" stroke-opacity=".3"/>
            <!-- spots -->
            <path d="M65 80 q-20 15 -5 32 q25 8 28 -10 q-4 -18 -23 -22Z" fill="#3a3a3a" opacity=".3"/>
            <path d="M120 65 q28 5 20 25 q-18 12 -26 0 q-4 -15 6 -25Z" fill="#3a3a3a" opacity=".25"/>
            <!-- eyes -->
            <circle cx="80" cy="110" r="6" fill="#2a2a2a"/>
            <circle cx="120" cy="110" r="6" fill="#2a2a2a"/>
            <!-- muzzle -->
            <ellipse cx="100" cy="135" rx="40" ry="28" fill="#ffd1d1"/>
            <circle cx="88" cy="135" r="4" fill="#7a3a3a"/>
            <circle cx="112" cy="135" r="4" fill="#7a3a3a"/>
          </g>
        </svg>
      </div>
      <div class="label">vaca</div>
      <div class="sparkle"></div>
    </button>
  </section>

  <footer>
    Consejos: sube el volumen del dispositivo. Si no suena, pulsa “Activar sonido”.
  </footer>
</div>

<div class="overlay" id="overlay">
  <div class="start-card">
    <div class="start-title">Activar sonido</div>
    <div class="start-sub">Para que funcione el audio en tu dispositivo, toca el botón.</div>
    <button class="start-btn" id="startBtn">Empezar</button>
  </div>
</div>

<script>
  // Datos de animales
  const ANIMALS = [
    { id:'perro', label:'perro', key:'1', color:'#FFD166', delayName: 420, onoma:'¡guau, guau!', sound: 'bark' },
    { id:'gato',  label:'gato',  key:'2', color:'#A8DADC', delayName: 420, onoma:'¡miau!',      sound: 'meow' },
    { id:'vaca',  label:'vaca',  key:'3', color:'#B7E4C7', delayName: 900, onoma:'¡muu!',       sound: 'moo'  }
  ];

  // Audio
  let audioCtx = null;
  let master = null;
  let whiteNoiseBuffer = null;

  function ensureAudio() {
    if (!audioCtx) {
      const Ctx = window.AudioContext || window.webkitAudioContext;
      audioCtx = new Ctx();
      master = audioCtx.createGain();
      master.gain.value = 0.9;
      master.connect(audioCtx.destination);
      // Create reusable white noise buffer
      const len = audioCtx.sampleRate * 1.0;
      whiteNoiseBuffer = audioCtx.createBuffer(1, len, audioCtx.sampleRate);
      const data = whiteNoiseBuffer.getChannelData(0);
      for (let i = 0; i < len; i++) data[i] = Math.random() * 2 - 1;
    }
    if (audioCtx.state === 'suspended') audioCtx.resume();
  }

  function noiseBurst({time, duration=0.12, band=500, q=0.8, gain=0.9}) {
    const src = audioCtx.createBufferSource();
    src.buffer = whiteNoiseBuffer;
    const bp = audioCtx.createBiquadFilter();
    bp.type = 'bandpass';
    bp.frequency.value = band;
    bp.Q.value = q;
    const g = audioCtx.createGain();
    g.gain.setValueAtTime(0.0001, time);
    g.gain.exponentialRampToValueAtTime(Math.max(0.0002, gain), time + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, time + duration);
    src.connect(bp).connect(g).connect(master);
    src.start(time);
    src.stop(time + duration + 0.05);
  }

  function oscTone({time, duration=0.3, type='square', startFreq=300, endFreq=300, gain=0.4, lpFreq=2000}) {
    const o = audioCtx.createOscillator();
    o.type = type;
    o.frequency.setValueAtTime(startFreq, time);
    if (endFreq !== startFreq) o.frequency.exponentialRampToValueAtTime(Math.max(20,endFreq), time + duration);
    const lpf = audioCtx.createBiquadFilter();
    lpf.type = 'lowpass';
    lpf.frequency.setValueAtTime(lpFreq, time);
    const g = audioCtx.createGain();
    g.gain.setValueAtTime(0.0001, time);
    g.gain.exponentialRampToValueAtTime(Math.max(0.0002, gain), time + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, time + duration);
    o.connect(lpf).connect(g).connect(master);
    o.start(time);
    o.stop(time + duration + 0.05);
  }

  function barkSound() {
    ensureAudio();
    const t = audioCtx.currentTime + 0.02;
    // Short "woof-woof" using noise + low pitch thunk
    noiseBurst({time:t, duration:0.09, band:450, q:1.0, gain:0.8});
    oscTone({time:t, duration:0.12, type:'square', startFreq:180, endFreq:140, gain:0.25, lpFreq:800});
    noiseBurst({time:t+0.14, duration:0.1, band:520, q:1.2, gain:0.75});
    oscTone({time:t+0.14, duration:0.11, type:'square', startFreq:220, endFreq:160, gain:0.22, lpFreq:900});
  }

  function meowSound() {
    ensureAudio();
    const t = audioCtx.currentTime + 0.02;
    // "miau" style: pitched sweep with a tiny chirp
    oscTone({time:t, duration:0.18, type:'triangle', startFreq:650, endFreq:520, gain:0.18, lpFreq:1800});
    oscTone({time:t+0.12, duration:0.35, type:'sawtooth', startFreq:520, endFreq:220, gain:0.22, lpFreq:1600});
    noiseBurst({time:t+0.28, duration:0.08, band:3000, q:2.5, gain:0.18});
  }

  function mooSound() {
    ensureAudio();
    const t = audioCtx.currentTime + 0.02;
    // Long low "muu"
    oscTone({time:t, duration:1.2, type:'sawtooth', startFreq:115, endFreq:95, gain:0.35, lpFreq:900});
    noiseBurst({time:t+0.0, duration:0.18, band:160, q:0.6, gain:0.3});
  }

  // Voz (nombre en español)
  let voiceES = null;
  function pickSpanishVoice() {
    const voices = window.speechSynthesis?.getVoices?.() || [];
    let es = voices.filter(v => v.lang && v.lang.toLowerCase().startsWith('es'));
    // Prefer infantil/friendly if available
    es.sort((a,b)=>{
      const pa = /child|infant|kid|niñ|xolo|sofia|lola|mario|camila|lucia|es-/.test((a.name||'').toLowerCase()) ? -1 : 0;
      const pb = /child|infant|kid|niñ|xolo|sofia|lola|mario|camila|lucia|es-/.test((b.name||'').toLowerCase()) ? -1 : 0;
      return pa - pb;
    });
    voiceES = es[0] || voices.find(v=>/es/i.test(v.lang)) || null;
  }
  if ('speechSynthesis' in window) {
    window.speechSynthesis.onvoiceschanged = pickSpanishVoice;
    // iOS sometimes needs a kick
    setTimeout(pickSpanishVoice, 200);
  }

  function speakSpanish(text, rate=0.95, pitch=1.05) {
    if (!('speechSynthesis' in window)) return;
    const u = new SpeechSynthesisUtterance(text);
    u.lang = (voiceES && voiceES.lang) || 'es-ES';
    if (voiceES) u.voice = voiceES;
    u.rate = rate;
    u.pitch = pitch;
    try{ window.speechSynthesis.cancel(); }catch{}
    window.speechSynthesis.speak(u);
  }

  // UI helpers
  const overlay = document.getElementById('overlay');
  const startBtn = document.getElementById('startBtn');
  function showOverlay(){ overlay.classList.add('show'); }
  function hideOverlay(){ overlay.classList.remove('show'); }

  function burst(el, color='#ffd166') {
    const box = el.getBoundingClientRect();
    const spark = el.querySelector('.sparkle');
    if (!spark) return;
    spark.innerHTML = '';
    const cx = box.width/2, cy = box.height/2;
    const colors = [
      color,
      '#ffffff',
      '#ff7aa2',
      '#7b4cff',
      '#7dd3fc',
      '#b7e4c7'
    ];
    const n = 10;
    for (let i=0;i<n;i++){
      const dot = document.createElement('i');
      const ang = (i / n) * Math.PI*2 + Math.random()*0.6;
      const dist = Math.random()*60 + 30;
      dot.style.left = cx + 'px';
      dot.style.top = cy + 'px';
      dot.style.background = colors[i % colors.length];
      dot.style.setProperty('--dx', Math.cos(ang)*dist + 'px');
      dot.style.setProperty('--dy', Math.sin(ang)*dist + 'px');
      spark.appendChild(dot);
      requestAnimationFrame(()=>dot.classList.add('fly'));
    }
    setTimeout(()=> spark.innerHTML='', 750);
  }

  function vibrate(ms=20) {
    if (navigator.vibrate) navigator.vibrate(ms);
  }

  function playAnimal(id) {
    const a = ANIMALS.find(x=>x.id===id);
    if (!a) return;
    ensureAudio();

    // Visual pulse and burst
    const btn = document.querySelector(`.animal-card[data-id="${id}"]`);
    if (btn){ burst(btn, a.color); btn.classList.add('active'); setTimeout(()=>btn.classList.remove('active'), 250); }
    vibrate(25);

    // Sound effect
    if (a.sound === 'bark') barkSound();
    else if (a.sound === 'meow') meowSound();
    else if (a.sound === 'moo') mooSound();

    // Nombre en español (tras un pequeño retraso)
    setTimeout(()=> speakSpanish(a.label, a.id==='vaca'?0.9:1.0, a.id==='vaca'?0.9:1.05), a.delayName);
  }

  // Build interactions
  const grid = document.getElementById('grid');
  grid.querySelectorAll('.animal-card').forEach((btn, idx)=>{
    btn.dataset.index = idx;
    btn.addEventListener('click', ()=>{
      if (!audioCtx || audioCtx.state === 'suspended') { ensureAudio(); hideOverlay(); }
      playAnimal(btn.dataset.id);
    }, {passive:true});

    btn.addEventListener('pointerdown', ()=>btn.classList.add('pressed'), {passive:true});
    btn.addEventListener('pointerup', ()=>btn.classList.remove('pressed'), {passive:true});
    btn.addEventListener('pointercancel', ()=>btn.classList.remove('pressed'), {passive:true});
  });

  // Keyboard controls
  let focused = 0;
  function focusIndex(i){
    const cards = [...grid.querySelectorAll('.animal-card')];
    if (!cards.length) return;
    focused = (i + cards.length) % cards.length;
    cards[focused].focus({preventScroll:true});
  }
  document.addEventListener('keydown', (e)=>{
    const key = e.key;
    if (overlay.classList.contains('show') && (key === 'Enter' || key === ' ')) {
      startAudioUnlock();
      return;
    }
    if (key==='1' || key==='2' || key==='3'){
      const anim = ANIMALS.find(a=>a.key===key);
      if (anim) playAnimal(anim.id);
    } else if (key === 'ArrowRight' || key === 'ArrowDown'){
      focusIndex(focused+1);
    } else if (key === 'ArrowLeft' || key === 'ArrowUp'){
      focusIndex(focused-1);
    } else if (key === 'Enter' || key === ' '){
      const card = grid.querySelectorAll('.animal-card')[focused];
      if (card) card.click();
    }
  });

  // Overlay start
  function startAudioUnlock(){
    ensureAudio();
    hideOverlay();
    speakSpanish('¡Vamos a jugar!', 1.02, 1.1);
    focusIndex(0);
  }
  startBtn.addEventListener('click', startAudioUnlock, {passive:true});
  overlay.addEventListener('click', (e)=>{ if (e.target === overlay) startAudioUnlock(); });

  // First interaction requirement: show overlay on load for mobile
  window.addEventListener('load', ()=>{
    // If iOS/Android likely: show overlay
    const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    if (isMobile) showOverlay();
    else ensureAudio(); // desktop can start immediately
    focusIndex(0);
  }, {once:true});

  // Make sure a Spanish voice is picked when available
  setTimeout(pickSpanishVoice, 600);
</script>
</body>
</html>