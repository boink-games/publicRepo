<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Cuento en Español - Juego de Contar</title>
<style>
  :root{
    --bg1:#f7f9ff;
    --bg2:#e9f7ff;
    --primary:#4c7cf0;
    --accent:#ff6b6b;
    --accent2:#ffd166;
    --good:#2ec4b6;
    --ink:#233451;
    --muted:#6b7c93;
    --button:#ffffff;
    --shadow:0 8px 24px rgba(0,0,0,0.12);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    color:var(--ink);
    background: linear-gradient(180deg, var(--bg1), var(--bg2));
    display:flex;
    flex-direction:column;
  }
  .app{
    min-height:100%;
    display:flex;
    flex-direction:column;
    padding: max(8px, env(safe-area-inset-top)) max(8px, env(safe-area-inset-right)) max(8px, env(safe-area-inset-bottom)) max(8px, env(safe-area-inset-left));
    gap:10px;
  }
  header{
    display:flex; align-items:center; justify-content:space-between;
    gap:12px;
  }
  .title{
    display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.5px;
    color:var(--primary);
    font-size:clamp(18px, 2.4vw, 24px);
  }
  .title .dot{
    width:14px; height:14px; border-radius:50%; background:linear-gradient(135deg, var(--primary), #9cc1ff);
    box-shadow:var(--shadow);
  }
  .controls{
    display:flex; gap:8px; align-items:center; flex-wrap:wrap;
  }
  button{
    -webkit-tap-highlight-color: transparent;
  }
  .btn{
    appearance:none; border:0; background:var(--button); color:var(--ink);
    border-radius:14px; padding:10px 14px; display:inline-flex; align-items:center; gap:8px;
    font-weight:700; box-shadow:var(--shadow); cursor:pointer; transition:transform .06s ease, background .2s ease;
    touch-action:manipulation; user-select:none;
  }
  .btn:active{ transform:scale(.98) }
  .btn.primary{ background:var(--primary); color:white }
  .btn.round{ width:48px; height:48px; justify-content:center; padding:0; border-radius:16px }
  .btn.big{ height:56px; border-radius:16px; padding:12px 18px; font-size:16px }
  .badge{
    background:#eef3ff; color:var(--primary); padding:6px 10px; border-radius:999px; font-weight:700; min-width:54px; text-align:center; box-shadow:var(--shadow);
  }
  main{
    flex:1; display:flex; flex-direction:column; gap:8px;
  }
  .board{
    flex:1; display:grid; place-items:center; padding:8px;
  }
  .card{
    width:min(1100px, 100%);
    background:white; border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:min(28px, 4vw);
    display:flex; flex-direction:column; gap:18px;
  }
  .topRow{
    display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px;
  }
  .progressWrap{
    flex:1; display:flex; align-items:center; gap:10px; min-width:160px;
  }
  .progress{
    position:relative; flex:1; height:10px; background:#eff3f7; border-radius:999px; overflow:hidden;
  }
  .bar{ position:absolute; inset:0; transform-origin:left; background:linear-gradient(90deg, var(--primary), #8cc8ff); width:0%; }
  .grid{
    display:grid; gap:min(16px,3vw);
    grid-template-columns: repeat(auto-fit, minmax(min(22vw,140px), 1fr));
    align-items:center; justify-items:center;
    padding:6px;
  }
  .item{
    width: min(22vw, 140px);
    height: min(22vw, 140px);
    min-width:80px; min-height:80px;
    display:grid; place-items:center;
    background: #f8fbff;
    border-radius:22px;
    box-shadow:0 6px 16px rgba(0,0,0,0.08) inset, 0 6px 16px rgba(0,0,0,0.05);
    cursor:pointer;
    position:relative;
    transition:transform .08s ease, box-shadow .2s ease;
    touch-action:manipulation;
  }
  .item:active{ transform:scale(.98) }
  .pop{ animation:pop .25s ease }
  @keyframes pop { 0%{ transform:scale(1) } 40%{ transform:scale(1.08) } 100%{ transform:scale(1) } }
  .icon{ width:76%; height:76% }
  .bottom{
    display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
  }
  .numberWrap{
    display:flex; align-items:baseline; gap:14px; flex-wrap:wrap;
  }
  .num{
    font-size:clamp(34px, 6.5vw, 64px); font-weight:900; color:var(--ink); letter-spacing:1px;
  }
  .word{
    font-size:clamp(20px, 4.2vw, 36px); font-weight:800; color:var(--primary);
  }
  .hint{
    color:var(--muted); font-size:clamp(12px, 2.6vw, 14px);
  }
  .overlay{
    position:fixed; inset:0; background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(233,247,255,.95));
    display:flex; align-items:center; justify-content:center; padding:20px; z-index:20;
  }
  .modal{
    width:min(680px, 92vw);
    background:white; border-radius:22px; padding:24px;
    box-shadow:0 12px 48px rgba(0,0,0,0.2);
    display:flex; flex-direction:column; gap:18px; text-align:center;
  }
  .modal h1{ margin:0; font-size:clamp(24px, 6vw, 36px); color:var(--primary) }
  .modal p{ margin:0; color:var(--ink); font-size:clamp(14px, 3.4vw, 16px) }
  .modal .list{ text-align:left; background:#f6fbff; border-radius:16px; padding:12px 14px; color:#36506b }
  .pill{
    display:inline-block; padding:6px 10px; background:#eef7ff; border-radius:999px; color:#36506b; font-weight:700; margin:4px 6px 0 0
  }
  .sr-only{
    position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="title"><span class="dot"></span> Cuenta en Español</div>
    <div class="controls">
      <div class="badge" id="stepBadge" aria-live="polite">1/10</div>
      <button class="btn round" id="btnPrev" aria-label="Anterior" title="Anterior (←)">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true"><path d="M15.5 5l-7 7 7 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <button class="btn big primary" id="btnSpeak" aria-label="Escuchar número" title="Repetir (Espacio)">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true"><path d="M11 5l-4 4H3v6h4l4 4z" fill="currentColor"/><path d="M15.54 8.46a5 5 0 010 7.07M19.07 4.93a10 10 0 010 14.14" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
        Escuchar
      </button>
      <button class="btn round" id="btnNext" aria-label="Siguiente" title="Siguiente (→ / Enter)">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.5 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>
  </header>

  <main>
    <div class="board">
      <div class="card" id="card">
        <div class="topRow">
          <div class="progressWrap" aria-label="Progreso">
            <div class="progress"><div class="bar" id="bar"></div></div>
          </div>
          <div class="hint">Toca cualquier imagen para escuchar el número</div>
        </div>

        <div id="grid" class="grid" role="group" aria-label="Objetos para contar"></div>

        <div class="bottom">
          <div class="numberWrap" aria-live="polite">
            <div class="num" id="num">1</div>
            <div class="word" id="word">uno</div>
          </div>
          <div class="hint">
            Controles: ←/→ o Enter para cambiar, Espacio o R para repetir
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<div class="overlay" id="intro">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="t1">
    <h1 id="t1">¡Vamos a contar en español!</h1>
    <p>Observa los dibujos. Debajo verás el número y su nombre en español. Toca cualquier dibujo o el botón “Escuchar” para oír el número.</p>
    <div class="list">
      - Toca o haz clic en un dibujo: vuelve a oír el número.<br/>
      - Usa los botones o desliza a los lados para cambiar el número.<br/>
      - Teclas: ←/→ o Enter para cambiar, Espacio o R para repetir.
    </div>
    <div>
      <span class="pill">Edades: preescolar</span>
      <span class="pill">Voz española</span>
      <span class="pill">Sin conexión de datos</span>
    </div>
    <button class="btn big primary" id="startBtn" style="margin-top:6px">
      <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true"><path d="M8 5v14l11-7z" fill="white"/></svg>
      Jugar
    </button>
    <p class="hint">Nota: El audio usa la voz del dispositivo (español). Activa el sonido.</p>
  </div>
</div>

<script>
(function(){
  const words = ["cero","uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez"];
  const minN = 1;
  const maxN = 10;
  let current = 1;
  let esVoice = null;
  let audioEnabled = false;
  let touchStartX = null;

  const grid = document.getElementById('grid');
  const numEl = document.getElementById('num');
  const wordEl = document.getElementById('word');
  const bar = document.getElementById('bar');
  const stepBadge = document.getElementById('stepBadge');
  const btnPrev = document.getElementById('btnPrev');
  const btnNext = document.getElementById('btnNext');
  const btnSpeak = document.getElementById('btnSpeak');
  const intro = document.getElementById('intro');
  const startBtn = document.getElementById('startBtn');
  const card = document.getElementById('card');

  const iconTypes = ["apple","balloon","ball","star"];
  const palettes = {
    apple: ["#ff6b6b","#ff8787","#ff9f9f"],
    balloon: ["#7dd87d","#6bd1ff","#ff8cc8","#ffd166"],
    ball: ["#ffd166","#8ecae6","#9b5de5","#00d1b2"],
    star: ["#ffd166","#ffad66","#ffee99"]
  };

  function pickSpanishVoice(){
    const voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
    let v = voices.find(v=>/^es(-|_|$)/i.test(v.lang) && /Google|Samantha|Paulina|Monica|Luciana|Camila|Jorge|Victoria|Veena/i.test(v.name)) ||
            voices.find(v=>/^es(-|_|$)/i.test(v.lang)) ||
            voices.find(v=>/spanish/i.test(v.name));
    esVoice = v || null;
  }

  if ('speechSynthesis' in window) {
    pickSpanishVoice();
    window.speechSynthesis.onvoiceschanged = () => pickSpanishVoice();
  }

  function speak(text){
    if(!audioEnabled || !('speechSynthesis' in window)) return;
    try{
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      if(esVoice) u.voice = esVoice;
      u.lang = esVoice?.lang || "es-ES";
      u.rate = 0.9;
      u.pitch = 1.0;
      speechSynthesis.speak(u);
    }catch(e){}
  }

  function choice(arr){ return arr[Math.floor(Math.random()*arr.length)] }

  function getIconSVG(type, color){
    const stroke = "rgba(0,0,0,0.15)";
    if(type==="apple"){
      return `
        <svg class="icon" viewBox="0 0 100 100" aria-hidden="true">
          <defs>
            <radialGradient id="g1" cx="40%" cy="35%" r="70%">
              <stop offset="0%" stop-color="#fff" stop-opacity=".9"/>
              <stop offset="60%" stop-color="${color}" stop-opacity="1"/>
              <stop offset="100%" stop-color="${color}"/>
            </radialGradient>
          </defs>
          <path d="M64 18c1 6-4 12-9 13 0-7 5-12 9-13z" fill="#2ecc71"/>
          <path d="M73 40c0 23-17 39-23 39S27 63 27 40c0-12 10-21 23-21s23 9 23 21z" fill="url(#g1)" stroke="${stroke}"/>
          <path d="M50 18c3-6 9-10 17-10-4 8-11 10-17 10z" fill="#6ab04c"/>
          <circle cx="61" cy="48" r="5" fill="rgba(255,255,255,0.7)"/>
        </svg>
      `;
    }
    if(type==="balloon"){
      return `
        <svg class="icon" viewBox="0 0 100 100" aria-hidden="true">
          <defs>
            <linearGradient id="g2" x1="0" x2="1">
              <stop offset="0%" stop-color="#fff" stop-opacity=".8"/>
              <stop offset="40%" stop-color="${color}" stop-opacity="1"/>
              <stop offset="100%" stop-color="${shade(color, -10)}"/>
            </linearGradient>
          </defs>
          <ellipse cx="50" cy="45" rx="26" ry="32" fill="url(#g2)" stroke="rgba(0,0,0,0.12)"/>
          <path d="M50 77c-3 0-6-3-7-6 2 1 5 2 7 2s5-1 7-2c-1 3-4 6-7 6z" fill="${shade(color,-20)}"/>
          <path d="M50 77c2 10-6 12-2 21" fill="none" stroke="${shade(color,-30)}" stroke-width="2"/>
        </svg>
      `;
    }
    if(type==="ball"){
      return `
        <svg class="icon" viewBox="0 0 100 100" aria-hidden="true">
          <defs>
            <radialGradient id="g3" cx="35%" cy="30%" r="70%">
              <stop offset="0%" stop-color="#ffffff" stop-opacity=".9"/>
              <stop offset="70%" stop-color="${color}"/>
              <stop offset="100%" stop-color="${shade(color,-10)}"/>
            </radialGradient>
          </defs>
          <circle cx="50" cy="50" r="34" fill="url(#g3)" stroke="${stroke}"/>
          <path d="M25 45c10 2 18 2 25 0 7-2 13-6 25-8" fill="none" stroke="rgba(0,0,0,0.15)" stroke-width="3" stroke-linecap="round"/>
          <path d="M30 68c12-2 24-2 40 1" fill="none" stroke="rgba(0,0,0,0.15)" stroke-width="3" stroke-linecap="round"/>
        </svg>
      `;
    }
    // star
    return `
      <svg class="icon" viewBox="0 0 100 100" aria-hidden="true">
        <defs>
          <linearGradient id="g4" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#fffce3"/>
            <stop offset="50%" stop-color="${color}"/>
            <stop offset="100%" stop-color="${shade(color,-10)}"/>
          </linearGradient>
        </defs>
        <path d="${starPath(50,50,28,12,5)}" fill="url(#g4)" stroke="rgba(0,0,0,0.12)"/>
      </svg>
    `;
  }

  function shade(hex, amt){
    // hex like #rrggbb
    try{
      let c = hex.replace('#','');
      if(c.length===3){ c = c.split('').map(x=>x+x).join(''); }
      let r = Math.max(0, Math.min(255, parseInt(c.substring(0,2),16)+amt));
      let g = Math.max(0, Math.min(255, parseInt(c.substring(2,4),16)+amt));
      let b = Math.max(0, Math.min(255, parseInt(c.substring(4,6),16)+amt));
      return "#" + [r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
    }catch(e){ return hex }
  }

  function starPath(cx, cy, outerR, innerR, spikes){
    let path = "", rot = Math.PI/2*3, step = Math.PI/spikes;
    let x = cx, y = cy - outerR;
    path += `M ${x} ${y}`;
    for(let i=0;i<spikes;i++){
      x = cx + Math.cos(rot) * outerR;
      y = cy + Math.sin(rot) * outerR;
      path += ` L ${x} ${y}`;
      rot += step;

      x = cx + Math.cos(rot) * innerR;
      y = cy + Math.sin(rot) * innerR;
      path += ` L ${x} ${y}`;
      rot += step;
    }
    path += " Z";
    return path;
  }

  function updateUI(){
    numEl.textContent = String(current);
    wordEl.textContent = words[current];
    stepBadge.textContent = `${current}/${maxN}`;
    bar.style.width = `${(current-minN)/(maxN-minN)*100}%`;
    renderGrid(current);
  }

  function renderGrid(n){
    grid.innerHTML = "";
    const type = choice(iconTypes);
    const colors = palettes[type];
    for(let i=0; i<n; i++){
      const wrap = document.createElement('button');
      wrap.className = "item";
      wrap.setAttribute('aria-label', `Dibujo ${i+1} de ${n}. Toca para escuchar ${words[n]}`);
      wrap.innerHTML = getIconSVG(type, choice(colors));
      wrap.addEventListener('click', ()=>{
        wrap.classList.remove('pop'); // reset
        // Trigger reflow
        void wrap.offsetWidth;
        wrap.classList.add('pop');
        speak(words[n]);
      }, {passive:true});
      grid.appendChild(wrap);
    }
  }

  function setNumber(n, speakIt=true){
    current = Math.max(minN, Math.min(maxN, n));
    updateUI();
    if(speakIt) speak(words[current]);
  }

  function next(){ setNumber(current+1); }
  function prev(){ setNumber(current-1); }

  btnPrev.addEventListener('click', ()=>prev());
  btnNext.addEventListener('click', ()=>next());
  btnSpeak.addEventListener('click', ()=>speak(words[current]));

  // Keyboard controls
  document.addEventListener('keydown', (e)=>{
    if(intro && !intro.hidden) return;
    if(e.key === "ArrowRight" || e.key === "Enter"){ e.preventDefault(); next(); }
    else if(e.key === "ArrowLeft" || e.key === "Backspace"){ e.preventDefault(); prev(); }
    else if(e.key.toLowerCase() === " " || e.key.toLowerCase() === "r"){ e.preventDefault(); speak(words[current]); }
    else if(/^[0-9]$/.test(e.key)){ 
      const k = parseInt(e.key,10);
      if(k>=0 && k<=9){
        const target = k===0 ? 10 : k; // use 0 for 10
        setNumber(target);
      }
    }
  });

  // Swipe gestures
  function onTouchStart(e){
    if(e.touches.length!==1) return;
    touchStartX = e.touches[0].clientX;
  }
  function onTouchEnd(e){
    if(touchStartX===null) return;
    const dx = (e.changedTouches[0].clientX - touchStartX);
    const threshold = 40;
    if(Math.abs(dx) > threshold){
      if(dx < 0) next(); else prev();
    }
    touchStartX = null;
  }
  card.addEventListener('touchstart', onTouchStart, {passive:true});
  card.addEventListener('touchend', onTouchEnd, {passive:true});

  // Start overlay
  startBtn.addEventListener('click', ()=>{
    audioEnabled = true;
    intro.hidden = true;
    setTimeout(()=> setNumber(1, true), 50);
  });

  // Initialize static UI before start
  updateUI();

  // Resize handling for safe layout
  window.addEventListener('resize', ()=>{ /* layout recalculated via CSS grid */ });

})();
</script>
</body>
</html>