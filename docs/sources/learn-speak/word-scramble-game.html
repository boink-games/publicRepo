<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Word Scramble Game</title>
  <style>
    :root{
      --bg1:#0f172a;
      --bg2:#1e293b;
      --accent:#22d3ee;
      --accent-2:#a78bfa;
      --good:#34d399;
      --bad:#f87171;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --tile:#111827;
      --tile-2:#0b1220;
      --btn:#0ea5e9;
      --shadow:rgba(0,0,0,.35);
      --radius:16px;
      --spacing: clamp(12px, 2.5vw, 20px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 800px at 10% -20%, #0b1220, transparent 60%),
                  radial-gradient(1200px 800px at 110% 120%, #0b1220, transparent 60%),
                  linear-gradient(120deg, var(--bg1), var(--bg2));
      background-size: 200% 200%;
      animation:bg-pan 18s ease-in-out infinite;
      display:flex;
      align-items:center;
      justify-content:center;
      -webkit-font-smoothing:antialiased;
      -webkit-tap-highlight-color: transparent;
    }
    @keyframes bg-pan {
      0%,100%{background-position:0% 0%}
      50%{background-position:100% 100%}
    }

    .game{
      width:min(100%, 820px);
      padding: clamp(12px, 3vw, 28px);
    }

    .card{
      position:relative;
      border-radius: var(--radius);
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 45px var(--shadow);
      padding: clamp(16px, 4vw, 28px);
      overflow:hidden;
    }

    header.appbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom: clamp(10px, 2.5vw, 16px);
    }
    .title{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.5px;
      font-size: clamp(20px, 4.5vw, 28px);
    }
    .spark{
      width: clamp(22px, 5vw, 28px);
      height: clamp(22px, 5vw, 28px);
      border-radius: 8px;
      background: conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent-2), var(--accent));
      box-shadow: 0 4px 18px rgba(167,139,250,.55), inset 0 0 10px rgba(34,211,238,.35);
      animation: spin 5s linear infinite;
    }
    @keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }

    .icon-btn{
      appearance:none;border:none;background:rgba(255,255,255,.08);
      color:var(--text); padding:10px 12px; border-radius:12px;
      display:inline-flex; align-items:center; gap:8px;
      font-weight:600; cursor:pointer;
      transition: transform .08s ease, background .2s ease;
      user-select:none;
    }
    .icon-btn:active{ transform:scale(.96) }
    .icon-btn[aria-pressed="false"] .ic-mute{display:none}
    .icon-btn[aria-pressed="true"] .ic-sound{display:none}

    .status{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      color:var(--muted);
      font-size: clamp(12px, 2.6vw, 14px);
      margin-bottom: clamp(10px, 2.5vw, 16px);
    }
    .badge{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      padding:6px 10px; border-radius:10px;
      color:var(--text);
    }

    .scramble-area{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      margin: clamp(8px, 3vw, 16px) 0 clamp(14px, 4vw, 22px);
      min-height: clamp(110px, 26vw, 160px);
      position:relative;
    }
    .tiles{
      display:flex; flex-wrap:wrap; gap: clamp(8px, 2vw, 14px);
      align-items:center; justify-content:center;
      width:100%;
    }
    .tile{
      appearance:none; border:none; cursor:pointer;
      font-weight:800; letter-spacing:.5px;
      font-size: clamp(20px, 6vw, 34px);
      line-height:1; padding: clamp(12px, 3vw, 16px) clamp(10px, 3vw, 14px);
      border-radius:14px;
      color:#eaf6ff;
      background: linear-gradient(180deg, #1e293b, #0f172a);
      box-shadow:
        0 6px 18px rgba(2,8,23,.55),
        inset 0 2px 2px rgba(255,255,255,.08),
        0 1px 0 rgba(255,255,255,.15);
      transform: translateZ(0);
      transition: transform .12s ease, filter .2s ease, opacity .2s ease;
      user-select:none;
    }
    .tile:hover{ filter:brightness(1.05) }
    .tile:active{ transform: translateY(1px) scale(.98) }
    .tile[disabled]{
      opacity:.35; cursor:not-allowed; filter:saturate(.5);
    }
    .pulse{
      animation: pulse 1.4s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ transform:translateZ(0) }
      50%{ transform:translateZ(0) scale(1.02)}
    }

    .input-row{
      display:flex; gap:10px; align-items:center; width:100%;
      margin-top: clamp(8px, 2.5vw, 12px);
    }
    .guess{
      flex:1; min-width:0;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      padding: 12px 14px;
      font-size: clamp(16px, 4vw, 20px);
      border-radius:12px;
      outline:none;
      transition:border-color .2s ease, box-shadow .2s ease;
    }
    .guess:focus{
      border-color: rgba(34,211,238,.65);
      box-shadow: 0 0 0 4px rgba(34,211,238,.15);
    }
    .submit{
      background: linear-gradient(180deg, #22d3ee, #06b6d4);
      color:#06202a; font-weight:800;
      border:none; padding: 12px 16px; border-radius:12px;
      box-shadow: 0 10px 25px rgba(6,182,212,.35), inset 0 1px 0 rgba(255,255,255,.6);
      font-size: clamp(15px, 3.5vw, 18px);
      cursor:pointer; transition:transform .08s ease, filter .2s ease; user-select:none;
    }
    .submit:active{ transform: translateY(1px) }
    .submit:disabled{ opacity:.7; cursor:not-allowed }

    .controls{
      display:grid; grid-template-columns: repeat(4, 1fr);
      gap:10px; margin-top: clamp(12px, 3vw, 18px);
    }
    @media (max-width:520px){
      .controls{ grid-template-columns: repeat(2, 1fr) }
    }
    .ctrl{
      appearance:none; border:none; border-radius:12px;
      padding: 10px 12px; font-weight:700;
      cursor:pointer; color:#0b1220;
      background: linear-gradient(180deg, #93c5fd, #60a5fa);
      box-shadow: 0 10px 20px rgba(96,165,250,.35), inset 0 1px 0 rgba(255,255,255,.6);
      transition: transform .08s ease, filter .2s ease;
    }
    .ctrl:active{ transform: translateY(1px) }
    .ctrl.alt{
      background: linear-gradient(180deg, #fca5a5, #f87171);
      box-shadow: 0 10px 20px rgba(248,113,113,.35), inset 0 1px 0 rgba(255,255,255,.6);
    }
    .ctrl.neutral{
      background: linear-gradient(180deg, #a7f3d0, #34d399);
      box-shadow: 0 10px 20px rgba(52,211,153,.35), inset 0 1px 0 rgba(255,255,255,.6);
    }
    .msg{
      min-height: 22px;
      color:var(--muted);
      margin-top: clamp(8px, 2vw, 12px);
      font-size: clamp(13px, 2.8vw, 15px);
    }
    .msg strong{ color:#fff }
    .highlight{ color:var(--accent) }

    .shake{
      animation: shake .35s ease;
    }
    @keyframes shake{
      0%,100%{ transform: translateX(0) }
      20%{ transform: translateX(-6px) }
      40%{ transform: translateX(6px) }
      60%{ transform: translateX(-3px) }
      80%{ transform: translateX(3px) }
    }
    .pop{
      animation: pop .5s ease;
    }
    @keyframes pop{
      0%{ transform:scale(1) }
      35%{ transform:scale(1.02) }
      100%{ transform:scale(1) }
    }

    canvas#confetti{
      position:fixed; inset:0; pointer-events:none; z-index:5;
    }

    footer.help{
      color:var(--muted);
      text-align:center; font-size: clamp(12px, 2.8vw, 14px);
      margin-top: 10px;
    }
    .kbd{
      padding:.06em .4em; border-radius:6px; border:1px solid rgba(255,255,255,.15);
      background: rgba(255,255,255,.06); color:#fff; font-weight:700;
    }
  </style>
</head>
<body>
  <div class="game">
    <div class="card" id="card">
      <header class="appbar">
        <div class="title">
          <div class="spark" aria-hidden="true"></div>
          <span>Word Scramble</span>
        </div>
        <button id="soundToggle" class="icon-btn" aria-pressed="true" title="Toggle sound" aria-label="Toggle sound">
          <span class="ic-sound">ðŸ”Š</span>
          <span class="ic-mute">ðŸ”‡</span>
          <span>Sound</span>
        </button>
      </header>

      <div class="status" role="status" aria-live="polite">
        <span class="badge">Score: <strong id="score">0</strong></span>
        <span class="badge">Best: <strong id="best">0</strong></span>
        <span>Round: <strong id="round">1</strong></span>
      </div>

      <section class="scramble-area">
        <div id="tiles" class="tiles pulse" role="group" aria-label="Scrambled letters"></div>
      </section>

      <div class="input-row" id="inputRow">
        <input id="guess" class="guess" type="text" inputmode="text" autocomplete="off" autocapitalize="none" spellcheck="false" placeholder="Type or tap letters..." aria-label="Your guess" />
        <button id="submit" class="submit">Submit</button>
      </div>

      <div class="controls">
        <button class="ctrl neutral" data-action="shuffle" title="Shuffle letters">Shuffle</button>
        <button class="ctrl" data-action="clear" title="Clear guess">Clear</button>
        <button class="ctrl alt" data-action="backspace" title="Backspace">Backspace</button>
        <button class="ctrl" data-action="skip" title="Skip word">Skip</button>
      </div>

      <p class="msg" id="msg" aria-live="polite"></p>
    </div>

    <canvas id="confetti"></canvas>

    <footer class="help">
      Tip: Tap letters to build your guess. Press <span class="kbd">Enter</span> to submit, <span class="kbd">Esc</span> to clear, or <span class="kbd">Space</span> to shuffle.
    </footer>
  </div>

  <script>
    (function(){
      'use strict';

      // Word list
      const WORDS = [
        'apple','banana','orange','grape','strawberry',
        'cherry','mango','peach','papaya','kiwi','melon','pear','plum','apricot',
        'lemon','lime','coconut','fig','guava','nectarine'
      ];

      // Elements
      const tilesEl = document.getElementById('tiles');
      const guessEl = document.getElementById('guess');
      const submitBtn = document.getElementById('submit');
      const scoreEl = document.getElementById('score');
      const bestEl = document.getElementById('best');
      const roundEl = document.getElementById('round');
      const msgEl = document.getElementById('msg');
      const soundToggleBtn = document.getElementById('soundToggle');
      const inputRow = document.getElementById('inputRow');
      const card = document.getElementById('card');

      // State
      let currentWord = '';
      let score = 0;
      let round = 1;
      let usedTileStack = []; // track tiles used by taps
      let tileChangeInternal = false;
      let allowSound = true;
      let seen = new Set();

      // Sound system (Web Audio â€“ lightweight, generated)
      const Sfx = (function(){
        let ctx;
        function ensureCtx(){
          if(!ctx){
            ctx = new (window.AudioContext || window.webkitAudioContext)();
          }
          if (ctx.state === 'suspended') ctx.resume();
        }
        function tone({freq=440, type='sine', duration=0.12, vol=0.08, attack=0.005, release=0.06, detune=0}){
          if(!allowSound) return;
          ensureCtx();
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = type;
          o.frequency.value = freq;
          o.detune.value = detune;
          const now = ctx.currentTime;
          g.gain.setValueAtTime(0, now);
          g.gain.linearRampToValueAtTime(vol, now + attack);
          g.gain.exponentialRampToValueAtTime(0.0001, now + duration + release);
          o.connect(g).connect(ctx.destination);
          o.start(now);
          o.stop(now + duration + release + 0.02);
        }
        function seq(notes, gap=0.02){
          let t = 0;
          notes.forEach(n=>{
            setTimeout(()=>tone(n), t*1000);
            t += (n.duration || 0.12) + gap;
          });
        }
        return {
          click(){ tone({freq:340,type:'triangle',duration:0.06,vol:0.06}); },
          shuffle(){ seq([{freq:420,type:'sawtooth',duration:0.06,vol:0.05},{freq:360,type:'sawtooth',duration:0.06,vol:0.05},{freq:300,type:'sawtooth',duration:0.06,vol:0.05}],0.01); },
          correct(){ seq([{freq:520,type:'square',duration:0.08,vol:0.07},{freq:700,type:'square',duration:0.09,vol:0.07},{freq:880,type:'square',duration:0.1,vol:0.07}],0.025); },
          wrong(){
            seq([{freq:220,type:'sawtooth',duration:0.12,vol:0.08},{freq:200,type:'sawtooth',duration:0.12,vol:0.07}],0.02);
          },
          newWord(){ seq([{freq:500,type:'triangle',duration:0.08,vol:0.05},{freq:660,type:'triangle',duration:0.08,vol:0.05}],0.02); },
          hint(){ tone({freq:260,type:'triangle',duration:0.09,vol:0.06}); }
        };
      })();

      function setSound(on){
        allowSound = !!on;
        soundToggleBtn.setAttribute('aria-pressed', on ? 'true':'false');
        localStorage.setItem('ws_sound', on ? '1' : '0');
      }
      // Restore sound preference
      setSound(localStorage.getItem('ws_sound') !== '0');
      soundToggleBtn.addEventListener('click', ()=>{
        setSound(!(soundToggleBtn.getAttribute('aria-pressed') === 'true'));
        Sfx.click();
      }, {passive:true});

      // Utils
      function shuffleArray(arr){
        for(let i = arr.length-1; i>0; i--){
          const j = (Math.random()*(i+1))|0;
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }
      function getScramble(word){
        if (word.length <= 1) return word;
        let letters = word.split('');
        let attempt = 0;
        let scrambled;
        do {
          scrambled = shuffleArray(letters.slice()).join('');
          attempt++;
          if(attempt>10) break;
        } while (scrambled === word);
        return scrambled;
      }
      function choice(list){
        return list[(Math.random()*list.length)|0];
      }

      // Confetti
      const confettiCanvas = document.getElementById('confetti');
      const ctx = confettiCanvas.getContext('2d');
      let confettiRunning = false;
      function resizeCanvas(){
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
      }
      window.addEventListener('resize', resizeCanvas, {passive:true});
      resizeCanvas();

      function confettiBurst() {
        const W = confettiCanvas.width, H = confettiCanvas.height;
        const colors = ['#22d3ee','#a78bfa','#34d399','#f472b6','#fbbf24','#60a5fa'];
        const pieces = new Array(120).fill(0).map(()=>({
          x: Math.random()*W,
          y: -20,
          r: Math.random()*6+4,
          c: colors[(Math.random()*colors.length)|0],
          s: Math.random()*2+2,
          a: Math.random()*Math.PI*2,
          w: Math.random()*2+1,
          rot: Math.random()*0.2-0.1
        }));
        const start = performance.now();
        confettiRunning = true;
        function draw(t){
          const elapsed = t - start;
          ctx.clearRect(0,0,W,H);
          pieces.forEach(p=>{
            p.y += p.s;
            p.x += Math.sin(p.a += 0.02)*0.8;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.a);
            ctx.fillStyle = p.c;
            ctx.globalAlpha = 0.9;
            ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r*0.6);
            ctx.restore();
          });
          if (elapsed < 1300) {
            requestAnimationFrame(draw);
          } else {
            ctx.clearRect(0,0,W,H);
            confettiRunning = false;
          }
        }
        requestAnimationFrame(draw);
      }

      // Game logic
      function renderTiles(word){
        const scrambled = getScramble(word);
        tilesEl.innerHTML = '';
        usedTileStack = [];
        scrambled.split('').forEach((ch, idx)=>{
          const btn = document.createElement('button');
          btn.className = 'tile';
          btn.type = 'button';
          btn.textContent = ch.toUpperCase();
          btn.setAttribute('data-idx', idx);
          btn.setAttribute('aria-label', 'letter ' + ch);
          tilesEl.appendChild(btn);
        });
      }

      function newWord(){
        // ensure we don't repeat same word too often
        if (seen.size === WORDS.length) seen.clear();
        let w;
        let attempts = 0;
        do {
          w = choice(WORDS);
          attempts++;
        } while (seen.has(w) && attempts < 10);
        seen.add(w);

        currentWord = w.toLowerCase();
        renderTiles(currentWord);
        guessEl.value = '';
        tilesEl.classList.add('pulse');
        msg('');
        roundEl.textContent = String(round);
        Sfx.newWord();
        setTimeout(()=>tilesEl.classList.remove('pulse'), 600);
        // Focus input for desktop users
        setTimeout(()=>{ try{ guessEl.focus({preventScroll:true}); }catch(_){} }, 0);
      }

      function msg(text){
        msgEl.innerHTML = text;
      }

      function updateScore(delta){
        score = Math.max(0, score + delta);
        scoreEl.textContent = String(score);
        // High score
        const best = Math.max(score, Number(localStorage.getItem('ws_best')||0));
        localStorage.setItem('ws_best', String(best));
        bestEl.textContent = String(best);
        // Animate score bump
        scoreEl.parentElement.classList.add('pop');
        setTimeout(()=>scoreEl.parentElement.classList.remove('pop'), 300);
      }

      function loadBest(){
        const best = Number(localStorage.getItem('ws_best')||0);
        bestEl.textContent = String(best);
      }

      function submitGuess(){
        const guess = guessEl.value.trim().toLowerCase();
        if (!guess) return;
        if (guess === currentWord){
          msg(`<strong>Nice!</strong> "${escapeHTML(currentWord)}" was correct.`);
          Sfx.correct();
          updateScore(+1);
          if (!confettiRunning) confettiBurst();
          card.classList.add('pop');
          setTimeout(()=>card.classList.remove('pop'), 300);
          round++;
          setTimeout(newWord, 500);
        } else {
          msg(`Not quite. Try again!`);
          Sfx.wrong();
          inputRow.classList.add('shake');
          setTimeout(()=>inputRow.classList.remove('shake'), 360);
        }
      }

      function escapeHTML(str){
        return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
      }

      // Letter tile interactions (tap-friendly)
      tilesEl.addEventListener('click', (e)=>{
        const btn = e.target.closest('.tile');
        if(!btn || btn.disabled) return;
        btn.disabled = true;
        usedTileStack.push(btn);
        tileChangeInternal = true;
        guessEl.value += btn.textContent.toLowerCase();
        tileChangeInternal = false;
        Sfx.click();
      });

      // Controls
      document.querySelector('.controls').addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-action]');
        if(!btn) return;
        const action = btn.getAttribute('data-action');
        switch(action){
          case 'shuffle':
            Sfx.shuffle();
            reshuffleTiles();
            resetTileUsage();
            break;
          case 'clear':
            Sfx.click();
            clearGuess();
            break;
          case 'backspace':
            Sfx.click();
            backspaceGuess();
            break;
          case 'skip':
            Sfx.hint();
            msg(`Skipped. The word was <strong class="highlight">${escapeHTML(currentWord)}</strong>.`);
            round++;
            setTimeout(newWord, 600);
            break;
        }
      });

      function reshuffleTiles(){
        const nodes = Array.from(tilesEl.children);
        for (let i = nodes.length - 1; i > 0; i--) {
          tilesEl.appendChild(nodes.splice(Math.floor(Math.random() * (i + 1)), 1)[0]);
        }
      }
      function resetTileUsage(){
        usedTileStack.forEach(b => { if (b && b.disabled) b.disabled = false; });
        usedTileStack = [];
      }
      function clearGuess(){
        guessEl.value = '';
        resetTileUsage();
      }
      function backspaceGuess(){
        const val = guessEl.value;
        if(val.length){
          guessEl.value = val.slice(0, -1);
          const last = usedTileStack.pop();
          if (last) last.disabled = false;
        }
      }

      // Events
      submitBtn.addEventListener('click', submitGuess);
      guessEl.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter'){ e.preventDefault(); submitGuess(); }
        else if (e.key === 'Escape'){ e.preventDefault(); clearGuess(); }
        else if (e.key === ' '){ e.preventDefault(); Sfx.shuffle(); reshuffleTiles(); resetTileUsage(); }
        else if (e.key === 'Backspace'){
          // if user backspaces, try to re-enable last used tile
          const last = usedTileStack.pop();
          if (last) last.disabled = false;
        }
      });
      // If user types manually, we don't try to keep tile usage in sync. Just clear usage.
      guessEl.addEventListener('input', ()=>{
        if (!tileChangeInternal) resetTileUsage();
      });

      // Initialize
      loadBest();
      newWord();
    })();
  </script>
</body>
</html>