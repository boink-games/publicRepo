<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Animals</title>
<link rel="stylesheet" href="./common.css" />
<style>
    .game-header {
        text-align: center;
        margin-bottom: 20px;
    }
    h1 {
        margin: 0;
        font-size: 3em;
        font-family: 'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', sans-serif;
        background-image: linear-gradient(to right, #d00000, #ff8c00, #ffcd3c, #90be6d, #43aa8b, #277da1);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }
</style>
<body>
<div id="close-btn" style="position:absolute; top:10px; right:10px; font-size:24px; cursor:pointer; z-index:9999;">âŒ</div>
<div class="game">
  <div class="game-header">
    <h1>ğŸ± Animals ğŸ¶</h1>
  </div>
  <div class="board">
    <div class="prompt">
      <button class="speak" id="speak">ğŸ”Š Say animal</button>
      <div class="feedback" id="fb"></div>
    </div>
    <div class="choices" id="choices"></div>
  </div>
</div>
<script src="./_tts.js"></script>
<script src="./_audio.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('close-btn').addEventListener('click', () => {
        console.log('Close button clicked!');
        window.location.assign('../../index.html');
    });
const ANIMALS = [
  {name:'cat', emoji:'ğŸ±', sfx:'meow'},
  {name:'dog', emoji:'ğŸ¶', sfx:'woof'},
  {name:'cow', emoji:'ğŸ®', sfx:'moo'},
  {name:'frog', emoji:'ğŸ¸', sfx:'ribbit'},
  {name:'lion', emoji:'ğŸ¦', sfx:'roar'},
  {name:'duck', emoji:'ğŸ¦†', sfx:'quack'},
  {name:'pig', emoji:'ğŸ·', sfx:'oink'},
  {name:'sheep', emoji:'ğŸ‘', sfx:'baa'},
  {name:'chicken', emoji:'ğŸ”', sfx:'cluck'},
  {name:'horse', emoji:'ğŸ´', sfx:'neigh'},
  {name:'monkey', emoji:'ğŸµ', sfx:'chatter'},
  {name:'elephant', emoji:'ğŸ˜', sfx:'trumpet'}
];
const PALE_COLORS = ['#ffadad', '#ffd6a5', '#fdffb6', '#caffbf', '#9bf6ff', '#a0c4ff', '#bdb2ff', '#ffc6ff'];
let answer = null;
function pick(n, arr){ const copy=[...arr]; const out=[]; while(out.length<n && copy.length){ out.push(copy.splice(Math.random()*copy.length|0,1)[0]); } return out; }
function newRound(){
  const opts = pick(9, ANIMALS);
  answer = opts[Math.random()*opts.length|0];
  renderChoices(opts);
  setTimeout(()=>{ window.LE_TTS.speak(answer.name); setTimeout(()=>window.LE_TTS.speak(answer.sfx), 350); }, 200);
  fb('');
}
function fb(t, ok){ const el=document.getElementById('fb'); el.textContent=t; el.className='feedback ' + (ok===true? 'ok':'') + (ok===false? ' bad':''); }
function renderChoices(opts){
  const wrap=document.getElementById('choices'); wrap.innerHTML='';
  const availableColors = [...PALE_COLORS]; // Create a mutable copy
  for(const a of opts){
    const btn=document.createElement('button');
    btn.className='card big';
    btn.textContent=a.emoji;
    const colorIndex = Math.floor(Math.random() * availableColors.length);
    btn.style.backgroundColor = availableColors[colorIndex];
    availableColors.splice(colorIndex, 1); // Remove the used color
    btn.setAttribute('aria-label', a.name);
    btn.onclick=()=>{
      const correct = a.name===answer.name;
      if(correct){
        window.LE_AUDIO?.playVictory?.();
        if(window.confetti) window.confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        window.LE_TTS.speak(a.sfx);
        setTimeout(()=>window.LE_TTS.speak('Yes, '+a.name+'!'), 350);
      } else {
        window.LE_AUDIO?.playBuzz?.();
        window.LE_TTS.speak('Try again');
      }
      fb(correct? 'âœ”': 'âœ–', correct);
      if(correct) setTimeout(newRound, 1200); // Increased delay for effects
    };
    wrap.appendChild(btn);
  }
}
document.getElementById('speak').onclick=()=>{ if(answer) window.LE_TTS.speak(answer.name); };
newRound();
});
</script>
</body>
</html>