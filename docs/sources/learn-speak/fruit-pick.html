<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fruits</title>
<link rel="stylesheet" href="./common.css" />
<body>
<header class="page-header">
  <div class="title-wrap">
    <div class="fruit-icons" aria-hidden="true">
      <span>🍎</span>
      <span>🍓</span>
      <span>🍌</span>
    </div>
    <h1 class="game-title">Fruits</h1>
    <div class="fruit-icons" aria-hidden="true">
      <span>🍇</span>
      <span>🍊</span>
      <span>🍐</span>
    </div>
  </div>
</header>
<div class="game">
  <div class="board">
    <div class="prompt">
      <div class="prompt-top">
        <button class="speak" id="speak">🔊 Listen</button>
        <div class="scoreboard" aria-live="polite">Score: <span id="score">0</span></div>
      </div>
      <p class="prompt-help">Tap to listen to the clue, then pick the matching fruit.</p>
      <div class="feedback" id="fb"></div>
    </div>
    <div class="choices" id="choices"></div>
  </div>
</div>
<script src="./_tts.js"></script>
<script src="./_audio.js"></script>
<script>
const FRUITS = [
  {name:'apple', emoji:'🍎'},
  {name:'banana', emoji:'🍌'},
  {name:'grapes', emoji:'🍇'},
  {name:'strawberry', emoji:'🍓'},
  {name:'orange', emoji:'🍊'},
  {name:'pear', emoji:'🍐'},
  {name:'pineapple', emoji:'🍍'},
  {name:'watermelon', emoji:'🍉'},
  {name:'kiwi', emoji:'🥝'}
];
let answer=null;
let score=0;
const scoreEl = document.getElementById('score');
function pick(n, arr){ const copy=[...arr]; const out=[]; while(out.length<n && copy.length){ out.push(copy.splice(Math.random()*copy.length|0,1)[0]); } return out; }
function newRound(){
  const opts = pick(6, FRUITS); answer = opts[Math.random()*opts.length|0];
  renderChoices(opts);
  setTimeout(()=>window.LE_TTS.speak(answer.name), 200);
  fb('');
}
function fb(t, ok){ const el=document.getElementById('fb'); el.textContent=t; el.className='feedback ' + (ok===true? 'ok':'') + (ok===false? ' bad':''); }
function renderChoices(opts){
  const wrap=document.getElementById('choices'); wrap.innerHTML='';
  for(const f of opts){
    const btn=document.createElement('button');
    btn.className='card big'; btn.textContent=f.emoji; btn.setAttribute('aria-label', f.name);
    btn.onclick=()=>{
      const correct=f.name===answer.name;
      if(correct){
        window.LE_AUDIO?.playDing?.();
        window.LE_TTS.speak('yum!');
        setTimeout(()=>window.LE_TTS.speak('Yes, '+f.name+'!'), 300);
        score += 1;
        updateScore();
      } else {
        window.LE_AUDIO?.playBuzz?.();
        window.LE_TTS.speak('Try again');
      }
      fb(correct? '✔': '✖', correct);
      if(correct) setTimeout(newRound, 900);
    };
    wrap.appendChild(btn);
  }
}
document.getElementById('speak').onclick=()=>{ if(answer) window.LE_TTS.speak(answer.name); };
function updateScore(){ if(scoreEl) scoreEl.textContent = score; }
updateScore();
newRound();
</script>
</body>
</html>
